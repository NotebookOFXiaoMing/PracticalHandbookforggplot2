[["index.html", "R语言ggplot2科研数据可视化实用手册 Chapter 1 R语言、Rstudio、R包ggplot2安装 (win10) 1.1 R语言官网 1.2 Rstudio官网", " R语言ggplot2科研数据可视化实用手册 闫明 2022年5月9号 Chapter 1 R语言、Rstudio、R包ggplot2安装 (win10) 1.1 R语言官网 R,最新版是4.2,我们安装的时候可以选择比最新版稍微第一个版本的4.1进行安装 1.2 Rstudio官网 Rstudio "],["绘图数据准备.html", "Chapter 2 绘图数据准备 2.1 文件的路径 2.2 读取数据 2.3 读取数据集以后对数据集进行操作", " Chapter 2 绘图数据准备 我们准备数据最常用的有两种选择： 一是文本文件存储数据 另外就是使用excel来准备数据 如果能够用电脑上的记事本打开查看里面的内容没有乱码，都是文本文件，不管文件的后缀名是txt csv tsv或者其他，这里推荐的文本编辑器是notpad++，这个打开文本文件很好用 2.1 文件的路径 首先是数据存储的路径，路径就是指数据存储到了电脑的哪个文件夹，以win系统电脑为例就是 盘符:/文件夹/文件/ 比如 D:/xiaoming/data.csv，路径分为 绝对路径 相对路径 绝度路径就是从盘符开始写的这种，相对路径是相对于当前的工作目录你自己的数据存储在哪里，这个相对路径的概念刚开始理解起来可能不是很好理解，初学者我建议大家还是采用绝对路径的写法 2.2 读取数据 如果是文本文件的数据，R语言读取的时候可以直接使用read.table()函数,这个函数接受三个参数， 一个是数据文件的存储路径 file= 一个是数据文件里的分隔符号 sep= 分隔符号比较常用的是逗号和制表符,如果是逗号分隔的文件可以把文件的后缀名直接更改为.csv这样可以直接双击用excel打开，如果是制表符分隔的文件，可以把后缀名改成.tsv 还有一个参数是数据文件是否有表头 header= 等于号后面写TRUE或者FALSE,TRUE就是有表头，FALSE就是没有表头 以如下数据集为例,逗号作为分隔符 文件里每行元素之间是用逗号分隔，第一行是数据集的表头，读取数据的命令是 dat01 &lt;- read.table(file = &quot;D:/Bookofggplot2/PracticalHandbookforggplot2/example_data/02-preparedata/dat01.txt&quot;,header = TRUE,sep=&quot;,&quot;) dat01 ## var1 var2 var3 ## 1 A 1 2 ## 2 B 1 3 这里 - read.table()里的内容是读取数据 &lt;- 这个符号是赋值 dat01是给读取进来的数据集起个名字 这个名字可以自己随便起，只要以字母开头就行 如下数据为例，制表符作为分隔符，制表符的表示方式是\\t 文件里每行元素之间是用逗号分隔，第一行是数据集的表头，读取数据的命令是 dat02 &lt;- read.table(file = &quot;D:/Bookofggplot2/PracticalHandbookforggplot2/example_data/02-preparedata/dat02.txt&quot;,header = TRUE,sep=&quot;\\t&quot;) dat02 ## var1..var2..var3 ## 1 1 2 3 ## 2 2 3 4 如果数据集没有表头，我们将header参数指定为FALSE dat03 &lt;- read.table(file = &quot;D:/Bookofggplot2/PracticalHandbookforggplot2/example_data/02-preparedata/dat03.txt&quot;,header = TRUE,sep=&quot;,&quot;) dat03 ## X1 X2 X3 ## 1 4 5 6 常用的分隔符号还有空格，如果空格作为分隔符的话，我们需要把sep=后面的双引号里直接敲一个空格就行了 因为逗号是非常常用的分隔符，R语言也提供了专门针对这种分隔符的读取数据函数read.csv()，但是作为初学者我建议大家还是直接使用read.table()函数，熟练了以后再探索其他数据读取函数 以上内容介绍的是读取文本文件的数据 如果想要读取excel存储的数据，一个办法是将excel转换为csv文件，然后通过read.table()函数来读取 另外的方式就是安装R包readxl,这个R包里有可以直接读取excel文件的函数read_excel(),直接运行install.packages(\"readxl\")命令联网就可以安装。read_excel()读取数据的时候一般需要准备两个参数，一个是path数据文件的路径，另外一个是col_names数据集是否有表头 示例数据集如下 这里需要注意一点是readxl这个R包每次使用都要运行library(readxl)加载这个R包 library(readxl) dat04 &lt;- read_excel(path = &quot;D:/Bookofggplot2/PracticalHandbookforggplot2/example_data/02-preparedata/dat04.xlsx&quot;,col_names = TRUE) dat04 ## # A tibble: 3 x 3 ## var1 var2 var3 ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 A 10 2 ## 2 B 20 4 ## 3 C 23 5 2.3 读取数据集以后对数据集进行操作 "],["r语言ggplot2散点图.html", "Chapter 3 R语言ggplot2散点图", " Chapter 3 R语言ggplot2散点图 "],["r语言ggplot2柱形图.html", "Chapter 4 R语言ggplot2柱形图 4.1 最基本的柱形图需要准备的数据 4.2 簇状柱形图 4.3 堆积柱形图", " Chapter 4 R语言ggplot2柱形图 4.1 最基本的柱形图需要准备的数据 一列x一列y 如果柱子垂直 x是离散型数据 y是连续型数据 如果想要水平的柱子，就把y设置成离散数据，x设置成连续数据 数据集 var1 var2 A 1 B 2 C 3 D 4 E 5 读取数据集 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01.xlsx&quot;) head(dat01) ## # A tibble: 5 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 A 1 ## 2 B 2 ## 3 C 3 ## 4 D 4 ## 5 E 5 作图代码 柱形图的函数有geom_col()和geom_bar(),具体有什么区别我没有仔细研究过，我自己习惯用geom_col()函数，做堆积柱形图和簇状柱形图的时候会使用geom_bar()函数 柱形图可以修改的参数分别是 color对应柱子的边框颜色 size 对应是边框的粗细 fill对应柱子的填充颜色 alpha对应的是柱子填充颜色的透明度，取值是0到1之间 width对应柱子的宽度 看如下代码的效果，你可以试着更改每个参数的值 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01.xlsx&quot;) head(dat01) ## # A tibble: 5 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 A 1 ## 2 B 2 ## 3 C 3 ## 4 D 4 ## 5 E 5 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_col(color=&quot;red&quot;,size=3, fill=&quot;blue&quot;,alpha=0.5, width = 0.2) 如果统一修改边框颜色，填充颜色这些属性，比如上面的例子，5个柱子全都设置成一样的，就把参数设置到aes()的外面。如果想要用数据中的某一列来映射颜色。需要把参数写到aes()的里面。 柱形图还有一个比较常用的操作是添加误差线，这里假设已经算好了标准差，我们将标准差整理到数据集里，格式如下 添加误差线的函数是geom_errorbar() 如果是垂直与x轴的误差线，需要制定ymin和ymax两个参数 作图代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 5 x 3 ## var1 var2 sd_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 A 1 0.5 ## 2 B 2 0.5 ## 3 C 3 0.5 ## 4 D 4 0.5 ## 5 E 5 0.5 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_col()+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value)) 误差线函数比较常用的三个参数是 width 调节误差线的宽度 color 误差线的颜色 lty 线的类型，就是实线 虚线 这些 更改这三个参数 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 5 x 3 ## var1 var2 sd_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 A 1 0.5 ## 2 B 2 0.5 ## 3 C 3 0.5 ## 4 D 4 0.5 ## 5 E 5 0.5 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_col(fill=&quot;grey&quot;)+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value), color=&quot;red&quot;, width=0.4, lty=&quot;dashed&quot;) 柱形图还有一个比较常用的操作是组间比较，做统计检验后添加p值或者显著性的星号，这里还是假设已经做好了统计检验，这里使用annotate()函数来添加线段和文本。这里有一个知识点是如果是离散数据作为x轴，第一个柱子的横坐标是1,第二个第三个依次是2，和3 这样 首先是annotate()函数添加添加文本，需要制定四个内容， 添加注释的类型 文本是geom = “text” 添加文本的位置 一个 x 和一个 y 添加文本的内容 label = “ABC” 如下代码 我在 A B 两个柱子中间 横坐标是1.5 纵坐标3的位置添加一个P value = 0.01的文本,设置文本的颜色为蓝色 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 5 x 3 ## var1 var2 sd_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 A 1 0.5 ## 2 B 2 0.5 ## 3 C 3 0.5 ## 4 D 4 0.5 ## 5 E 5 0.5 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_col(fill=&quot;grey&quot;)+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value), color=&quot;red&quot;, width=0.4, lty=&quot;dashed&quot;)+ annotate(geom = &quot;text&quot;,x=1.5,y=3, label=&quot;P value = 0.01&quot;,color=&quot;blue&quot;) 接下来是添加注释的线段，线段需要制定的参数是 geom=“segment” 线段的起始位置 x,y 线段的终止位置x y 还可以更改颜色 线型 粗细 之类的 看如下代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 5 x 3 ## var1 var2 sd_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 A 1 0.5 ## 2 B 2 0.5 ## 3 C 3 0.5 ## 4 D 4 0.5 ## 5 E 5 0.5 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_col(fill=&quot;grey&quot;)+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value), color=&quot;red&quot;, width=0.4, lty=&quot;dashed&quot;)+ annotate(geom = &quot;text&quot;,x=1.5,y=3, label=&quot;P value = 0.01&quot;,color=&quot;blue&quot;)+ annotate(geom = &quot;segment&quot;,x=1,y=1.5,xend=1,yend=2.8, color=&quot;black&quot;,size=1) 接下来再来添加两个线段 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 5 x 3 ## var1 var2 sd_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 A 1 0.5 ## 2 B 2 0.5 ## 3 C 3 0.5 ## 4 D 4 0.5 ## 5 E 5 0.5 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_col(fill=&quot;grey&quot;)+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value), color=&quot;red&quot;, width=0.4, lty=&quot;dashed&quot;)+ annotate(geom = &quot;text&quot;,x=1.5,y=3, label=&quot;P value = 0.01&quot;,color=&quot;blue&quot;)+ annotate(geom = &quot;segment&quot;,x=1,y=1.5,xend=1,yend=2.8, color=&quot;black&quot;,size=1)+ annotate(geom = &quot;segment&quot;,x=2,y=2.5,xend=2,yend=2.8, color=&quot;black&quot;,size=1)+ annotate(geom = &quot;segment&quot;,x=1,y=2.8,xend=2,yend=2.8, color=&quot;black&quot;,size=1) 用这个annotate()函数相对来说会比较繁琐，如果要添加比较多的线段的话代码会很长，但是这个可定制性比较强，我目前还想不到其他比较合适的替代方案 4.2 簇状柱形图 参考链接 https://r-graph-gallery.com/48-grouped-barplot-with-ggplot2.html 数据格式如下 var1 var2 value group1 A 13.411067 group1 B 6.884985 group1 C 37.514516 group2 A 25.970176 group2 B 12.292093 group2 C 10.388148 group3 A 3.411084 group3 B 2.060476 group3 C 9.582556 group4 A 4.190190 group4 B 11.724548 group4 C 3.871083 作图代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;dodge&quot;) 这里stat=\"identity\"我一直没有搞清楚是什么意思,记住是必须要写的 如果不加position=\"dodge\"默认是堆积柱形图 堆积柱形图的position应该设置为position=\"stack\" 簇状柱形图比较常用的修改参数是 不同组之前的显示顺序，默认是首字母 组内不同柱子的的排序，默认也是首字母 涉及到顺序的都是调节数据集的因子水平 代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot.xlsx&quot;) dat01$var1&lt;-factor(dat01$var1, levels = c(&quot;group3&quot;,&quot;group2&quot;,&quot;group4&quot;,&quot;group1&quot;)) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;dodge&quot;) dat01$var2&lt;-factor(dat01$var2, levels = c(&quot;B&quot;,&quot;C&quot;,&quot;A&quot;)) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;dodge&quot;) 堆积柱形图还有一个经常会遇到的问题是添加误差线，现在假设我们已经把标准差算好了，整理excel里，数据格式如下，在原有数据的基础上添加一列标准差的数据 var1 var2 value sd_value group1 A 13.411067 2 group1 B 6.884985 1 group1 C 37.514516 3 group2 A 25.970176 2 group2 B 12.292093 1 group2 C 10.388148 3 group3 A 3.411084 2 group3 B 2.060476 1 group3 C 9.582556 3 group4 A 4.190190 2 group4 B 11.724548 1 group4 C 3.871083 3 添加误差线的函数是 geom_errorbar() 作图代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;dodge&quot;)+ geom_errorbar(aes(ymin=value-sd_value, ymax=value+sd_value)) 误差线主要的调节参数就两个，一个是width误差线的宽度，一个是color颜色 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;dodge&quot;)+ geom_errorbar(aes(ymin=value-sd_value, ymax=value+sd_value), width=0.4, color=&quot;grey&quot;) 簇状柱形图的误差线全部集中在同一位置，需要我们用参数position = position_dodge(1)调节开,这里需要注意一点是如果调节误差线的位置，需要把fill=var2参数写到ggplot里，position_dodge()里面的数值具体应该设置多少我也搞不清楚，每次都要设置好几次 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value,fill=var2))+ geom_bar(stat=&quot;identity&quot;, position = &quot;dodge&quot;)+ geom_errorbar(aes(ymin=value-sd_value, ymax=value+sd_value), width=0.4, color=&quot;blue&quot;, position = position_dodge(0.9)) 其他的美化，比如让柱子贴着底，坐标轴标签，更改默认配色等 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value,fill=var2))+ geom_bar(stat=&quot;identity&quot;, position = &quot;dodge&quot;)+ geom_errorbar(aes(ymin=value-sd_value, ymax=value+sd_value), width=0.4, color=&quot;blue&quot;, position = position_dodge(0.9))+ scale_y_continuous(expand=expansion(mult=c(0,0.1)))+ scale_fill_manual(values = c(&quot;A&quot;=&quot;grey&quot;,&quot;B&quot;=&quot;black&quot;,&quot;C&quot;=&quot;green&quot;))+ labs(x=&quot;AAAAA&quot;,y=&quot;BBBBB&quot;) 4.2.1 接下来看每周一图里面的例子 这里 aes()的内容是可以写到作图函数里，也可以写到ggplot里，这里还是有区别的，比如上面提到的误差线的位置调节 library(readr) success_rates&lt;-read_csv(&quot;example_data/04-barplot/success_rates.csv&quot;) library(ggplot2) ggplot(success_rates) + # add bar for each discipline colored by gender geom_bar(aes(x = discipline, y = success, fill = gender), stat = &quot;identity&quot;, position = &quot;dodge&quot;) + # name axes and remove gap between bars and y-axis scale_y_continuous(&quot;Success Rate&quot;, expand = c(0, 0)) + scale_x_discrete(&quot;Discipline&quot;) + scale_fill_manual(values = c(&quot;#468189&quot;, &quot;#9DBEBB&quot;)) + # remove grey theme theme_classic(base_size = 18) + # rotate x-axis and remove superfluous axis elements theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0), axis.line = element_blank(), axis.ticks.x = element_blank()) 4.3 堆积柱形图 堆积柱形图和簇状柱形图的数据格式是一样的，自己的数据具体需要用堆积柱形图还是簇状柱形图自己斟酌，堆积柱形图我们只需要把簇状柱形图对应的position=\"dodge\"改成position=\"stack\"就可以了 dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;stack&quot;) 堆积柱形图有一个特点是除了展示真实数据外，还可以展示比例,需要我们把position=\"stack\"改成position=\"fill\" dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;fill&quot;) 接下来就是更改柱子的顺序，和簇状柱形图调节顺序一样，只要更改原始数据的因子水平,默认的顺序是从上往下排的 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot.xlsx&quot;) dat01$var1&lt;-factor(dat01$var1, levels = c(&quot;group3&quot;,&quot;group2&quot;,&quot;group4&quot;,&quot;group1&quot;)) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;stack&quot;) dat01$var2&lt;-factor(dat01$var2, levels = c(&quot;B&quot;,&quot;C&quot;,&quot;A&quot;)) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;stack&quot;) 堆积柱形图添加误差线不常用，但也有人有这个需求，需要对原始数据有一个累加处理用来指定误差线的y坐标 library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_01.xlsx&quot;) library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% mutate(new_col=cumsum(value)) -&gt; dat01 readr::write_csv(dat01,file=&quot;example_data/04-barplot/dat02_grouped_barplot_01.csv&quot;) dat01$var2&lt;-factor(dat01$var2, levels = c(&quot;C&quot;,&quot;B&quot;,&quot;A&quot;)) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;stack&quot;)+ geom_errorbar(aes(ymin=new_col-sd_value, ymax=new_col+sd_value), width=0.4, color=&quot;grey&quot;) 堆积柱形图还有一个经常遇到的问题是在图上添加文字，我们自数据集里添加新的列指定文本标签和文本标签的坐标, library(readxl) dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_02.xlsx&quot;) knitr::kable(dat01, &quot;simple&quot;) var1 var2 value sd_value text_y text group1 A 13.411067 2 45 a group1 B 6.884985 1 40 b group1 C 37.514516 3 20 c group2 A 25.970176 2 40 d group2 B 12.292093 1 18 e group2 C 10.388148 3 5 f group3 A 3.411084 2 12 g group3 B 2.060476 1 11 h group3 C 9.582556 3 5 i group4 A 4.190190 2 18 j group4 B 11.724548 1 10 k group4 C 3.871083 3 2 l 添加文本用到的函数是geom_text() dat01&lt;-read_excel(&quot;example_data/04-barplot/dat02_grouped_barplot_02.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=value))+ geom_bar(stat=&quot;identity&quot;, aes(fill=var2), position = &quot;stack&quot;)+ geom_text(aes(x=var1,y=text_y,label=text)) 美化 更改配色 4.3.1 实际例子 library(readr) library(tidyverse) bechdel_test_df&lt;-read_csv(&quot;example_data/04-barplot/bechdel_test_df.csv&quot;) ## Rows: 43 Columns: 4 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (2): year_group, clean_test ## dbl (2): category_count, category_prop ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. bechdel_test_text &lt;- read_csv(&quot;example_data/04-barplot/bechdel_test_text.csv&quot;) ## Rows: 5 Columns: 8 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (3): year_group, clean_test, label ## dbl (5): category_count, category_prop, prop_cum, prop_cum_lag, y ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. bechdel_step_df &lt;- read_csv(&quot;example_data/04-barplot/bechdel_step_df.csv&quot;) ## Rows: 9 Columns: 6 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (1): year_group ## dbl (5): category_prop, x_coord, x_end_coord, y_coord, y_end_coord ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. library(ggplot2) bechdel_test_df %&gt;% mutate(clean_test = factor(clean_test, levels = c(&quot;ok&quot;, &quot;dubious&quot;, &quot;men&quot;, &quot;notalk&quot;, &quot;nowomen&quot;)), clean_test = fct_rev(clean_test)) %&gt;% ggplot(aes(year_group, category_prop)) + geom_col(aes(fill = clean_test), width = 1, color = &quot;white&quot;, size = 0.6, show.legend = FALSE) + geom_segment(data = bechdel_step_df, aes(x = x_coord, xend = x_end_coord, y = category_prop, yend = category_prop), size = 1.5) + geom_segment(data = filter(bechdel_step_df, year_group != &quot;2010 -\\n&#39;13&quot;), aes(x = x_end_coord, xend = x_end_coord, y = y_coord, yend = y_end_coord), lineend = &quot;round&quot;, size = 1.5) + geom_segment(aes(x = 0.12, xend = 9.5, y = 0, yend = 0), size = 0.8) + geom_segment(aes(x = 0.25, xend = 9.5, y = 1, yend = 1), size = 0.8, color = &quot;#cdcdcd&quot;) + geom_segment(data = tibble(x = 0.12, xend = 0.5, y = c(0.25, 0.5, 0.75)), aes(x = x, xend = xend, y = y, yend = y), size = 0.8, color = &quot;#cdcdcd&quot;) + geom_text(data = tibble(x = 0, y = c(0, 0.25, 0.5, 0.75, 1), label = c(0, 25, 50, 75, 100)), aes(x = x, y = y, label = label), family = &quot;serif&quot;, size = 6, hjust = 1) + geom_text(data = tibble(x = 0.2, y = 1, label = &quot;%&quot;), aes(x = x, y = y, label = label), family = &quot;serif&quot;, size = 7, hjust = 1) + geom_text(data = tibble(x = c(0.5, 2.5, 4.5, 6.5, 8.5), y = -0.06, label = c(&quot;1970-\\n&#39;74&quot;, &quot;1980-\\n&#39;84&quot;, &quot;1990-\\n&#39;94&quot;, &quot;2000-\\n&#39;04&quot;, &quot;2010-\\n&#39;13&quot;)), aes(x = x, y = y, label = label), family = &quot;serif&quot;, size = 6, hjust = -0.2, lineheight = 0.55) + geom_segment(data = bechdel_test_text, aes(x = 9.5, xend = 9.75, y = y, yend = y), size = 0.8) + geom_text(data = bechdel_test_text, aes(x = 9.85, y = y, label = label), family = &quot;serif&quot;, hjust = 0, vjust = 0.5, size = 6, lineheight = 0.6) + annotate(&quot;text&quot;, x = 3.75, y = 0.22, label = &quot;PASS&quot;, family = &quot;serif&quot;, fontface = &quot;bold&quot;, size = 25, hjust = 0, vjust = 0.5) + annotate(&quot;text&quot;, x = 4, y = 0.75, label = &quot;FAIL&quot;, family = &quot;serif&quot;, fontface = &quot;bold&quot;, size = 25, hjust = 0, vjust = 0.5) + scale_y_continuous(expand = c(0, 0)) + scale_fill_manual(values = c(&quot;ok&quot; = &quot;#008fd5&quot;, &quot;dubious&quot; = &quot;#6bb2d5&quot;, &quot;men&quot; = &quot;#ffc9bf&quot;, &quot;notalk&quot; = &quot;#ff9380&quot;, &quot;nowomen&quot; = &quot;#ff2700&quot;)) + labs(title = &quot;The Bechdel Test Over Time&quot;, subtitle = &quot;How women are represented in movies&quot;, x = &quot;&quot;, y = &quot;&quot;, caption = &quot;Original plot by Fivethirtyeight | Replicated in R by Kaustav Sen&quot;) + coord_cartesian(clip = &quot;off&quot;) + theme_void() + theme( plot.title.position = &quot;plot&quot;, plot.title = element_text(family = &quot;serif&quot;, face = &quot;bold&quot;, size = 30, hjust = -0.12, margin = margin(b = 5)), plot.subtitle = element_text(family = &quot;serif&quot;, size = 24, hjust = -0.12, margin = margin(b = 25)), plot.caption = element_text(family = &quot;serif&quot;, size = 14, hjust = 0.5, vjust = -25, color = &quot;grey70&quot;), plot.margin = margin(20, 90, 25, 45), plot.background = element_rect(fill = &quot;#f0f0f0&quot;, color = &quot;#f0f0f0&quot;) ) "],["r语言ggplot2箱线图.html", "Chapter 5 R语言ggplot2箱线图 5.1 首先是箱线图 5.2 接下来是带有分组的箱线图 5.3 接下来是小提琴图 5.4 类似于箱线图/小提琴图的还有", " Chapter 5 R语言ggplot2箱线图 这一章主要介绍的是 箱线图 小提琴图 蜂群图 山脊图 这类，因为他们的作用都是一样的，主要就是为了展示数据分布 5.1 首先是箱线图 最基本的箱线图需要准备两列数据 读取数据 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 做箱线图使用到的函数是geom_boxplot() 最基本的箱线图的代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_boxplot() 箱线图比较常修改的参数是 color 边框颜色 fill 填充颜色 width 箱子整体的宽度 如果要修改成统一的颜色，就把参数写到aes()的外面，参数值是真实的颜色 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_boxplot(color=&quot;red&quot;, fill=&quot;blue&quot;, width=0.2) 如果要根据不同的变量赋予不同的颜色，就把参数写到aes()的里面，参数值是数据的列名 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_boxplot(aes(fill=var1)) 箱线图还有一个比较常用的操作是添加顶部和底部的小短线，这个geom_boxplot()函数里好像没有专门的参数设置，需要我们借助误差线函数geom_errorbar()来添加,这里展示的不是真实误差，而是数据集的最大值和最小值 这里需要先生成一个新的数据集，每个变量的最小值和最大值 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% summarise(max_value=max(var2), min_value=min(var2)) -&gt; dat01.1 dat01.1 ## # A tibble: 4 x 3 ## var1 max_value min_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 PAR_CH 0.787 0.418 ## 2 PARTNERS 0.810 0.422 ## 3 RND.PAIR 0.884 0.354 ## 4 SIBL 0.709 0.315 用这个新的数据集添加小短线 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% summarise(max_value=max(var2), min_value=min(var2)) -&gt; dat01.1 dat01.1 ## # A tibble: 4 x 3 ## var1 max_value min_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 PAR_CH 0.787 0.418 ## 2 PARTNERS 0.810 0.422 ## 3 RND.PAIR 0.884 0.354 ## 4 SIBL 0.709 0.315 library(ggplot2) ggplot()+ geom_boxplot(data=dat01,aes(x=var1,y=var2,fill=var1))+ geom_errorbar(data=dat01.1, aes(x=var1, ymin=min_value, ymax=max_value)) ggplot()+ geom_errorbar(data=dat01.1, aes(x=var1, ymin=min_value, ymax=max_value))+ geom_boxplot(data=dat01,aes(x=var1,y=var2,fill=var1)) 这里有一个知识点是每一个作图函数都可以用不同的数据集，如果要在同一个图上用不同的数据集的话，尽量把数据集接到作图函数里，不写到ggplot()函数里 ggplot2作图是不同函数依次叠加，所以排在后面的函数生成的图形会把前面的覆盖掉，如果觉得有影响 调换一下函数的顺序就可以 误差线函数对应的可以修改的参数比较常用的就是 - width 宽度 - color 颜色 - lty 线型 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% summarise(max_value=max(var2), min_value=min(var2)) -&gt; dat01.1 dat01.1 ## # A tibble: 4 x 3 ## var1 max_value min_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 PAR_CH 0.787 0.418 ## 2 PARTNERS 0.810 0.422 ## 3 RND.PAIR 0.884 0.354 ## 4 SIBL 0.709 0.315 library(ggplot2) ggplot()+ geom_errorbar(data=dat01.1, aes(x=var1, ymin=min_value, ymax=max_value), color=&quot;red&quot;,width=0.3,lty=&quot;dashed&quot;)+ geom_boxplot(data=dat01,aes(x=var1,y=var2,fill=var1)) 箱线图有时候还会添加统计检验的显著性等信息，额外的注释信息都可以借助annotate()函数实现，这里的一个小知识点是离散变量的x轴第一个位置是x=1 annotate() 函数比较常用的是添加文本和线段 添加文本需要用到的参数是 - geom = “text” - x，y的坐标 - label 文本的内容 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% summarise(max_value=max(var2), min_value=min(var2)) -&gt; dat01.1 dat01.1 ## # A tibble: 4 x 3 ## var1 max_value min_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 PAR_CH 0.787 0.418 ## 2 PARTNERS 0.810 0.422 ## 3 RND.PAIR 0.884 0.354 ## 4 SIBL 0.709 0.315 library(ggplot2) ggplot()+ geom_errorbar(data=dat01.1, aes(x=var1, ymin=min_value, ymax=max_value), color=&quot;red&quot;,width=0.3,lty=&quot;dashed&quot;)+ geom_boxplot(data=dat01,aes(x=var1,y=var2,fill=var1))+ annotate(geom=&quot;text&quot;,x=1.5,y=0.85, label=&quot;Pvalue = 0.01&quot;,color=&quot;blue&quot;, fontface=&quot;italic&quot;) 添加线段需要用到的参数是 - geom = “segment” - 线段起始位置的x，y坐标和线段终止位置的x，y坐标 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% summarise(max_value=max(var2), min_value=min(var2)) -&gt; dat01.1 dat01.1 ## # A tibble: 4 x 3 ## var1 max_value min_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 PAR_CH 0.787 0.418 ## 2 PARTNERS 0.810 0.422 ## 3 RND.PAIR 0.884 0.354 ## 4 SIBL 0.709 0.315 library(ggplot2) ggplot()+ geom_errorbar(data=dat01.1, aes(x=var1, ymin=min_value, ymax=max_value), color=&quot;red&quot;,width=0.3,lty=&quot;dashed&quot;)+ geom_boxplot(data=dat01,aes(x=var1,y=var2,fill=var1))+ annotate(geom=&quot;text&quot;,x=1.5,y=0.85, label=&quot;Pvalue = 0.01&quot;,color=&quot;blue&quot;, fontface=&quot;italic&quot;)+ annotate(geom = &quot;segment&quot;, x = 1,y = 0.8, xend = 1,yend = 0.82, size=1) annotate()函数添加相对比较繁琐，但可定制性比较强 再来添加两条线段 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(tidyverse) dat01 %&gt;% group_by(var1) %&gt;% summarise(max_value=max(var2), min_value=min(var2)) -&gt; dat01.1 dat01.1 ## # A tibble: 4 x 3 ## var1 max_value min_value ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 PAR_CH 0.787 0.418 ## 2 PARTNERS 0.810 0.422 ## 3 RND.PAIR 0.884 0.354 ## 4 SIBL 0.709 0.315 library(ggplot2) ggplot()+ geom_errorbar(data=dat01.1, aes(x=var1, ymin=min_value, ymax=max_value), color=&quot;red&quot;,width=0.3,lty=&quot;dashed&quot;)+ geom_boxplot(data=dat01,aes(x=var1,y=var2,fill=var1))+ annotate(geom=&quot;text&quot;,x=1.5,y=0.85, label=&quot;Pvalue = 0.01&quot;,color=&quot;blue&quot;, fontface=&quot;italic&quot;)+ annotate(geom = &quot;segment&quot;, x = 1,y = 0.8, xend = 1,yend = 0.82, size=1)+ annotate(geom = &quot;segment&quot;, x = 1,y = 0.82, xend = 2,yend = 0.82, size=1)+ annotate(geom = &quot;segment&quot;, x = 2,y = 0.82, xend = 2,yend = 0.815, size=1) 如果还想在不同的位置添加文本和线段，可以按照上述思路来设置 5.2 接下来是带有分组的箱线图 部分示例数据集如下 最基本的分组箱线图 library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(ggplot2) ggplot(data=dat02,aes(x=dose,y=len,fill=supp))+ geom_boxplot() 分组箱线图添加误差线,还是需要先生成一个新的数据集 library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(tidyverse) dat02 %&gt;% group_by(dose,supp) %&gt;% summarise(min_value=min(len), max_value=max(len)) -&gt; dat02.1 ## `summarise()` has grouped output by &#39;dose&#39;. You can override using the `.groups` argument. dat02.1 ## # A tibble: 6 x 4 ## # Groups: dose [3] ## dose supp min_value max_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 dose_1 OJ 8.2 21.5 ## 2 dose_1 VC 4.2 11.5 ## 3 dose_2 OJ 14.5 27.3 ## 4 dose_2 VC 13.6 22.5 ## 5 dose_3 OJ 22.4 30.9 ## 6 dose_3 VC 18.5 33.9 用算好的数据添加误差线 library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(tidyverse) dat02 %&gt;% group_by(dose,supp) %&gt;% summarise(min_value=min(len), max_value=max(len)) -&gt; dat02.1 ## `summarise()` has grouped output by &#39;dose&#39;. You can override using the `.groups` argument. dat02.1 ## # A tibble: 6 x 4 ## # Groups: dose [3] ## dose supp min_value max_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 dose_1 OJ 8.2 21.5 ## 2 dose_1 VC 4.2 11.5 ## 3 dose_2 OJ 14.5 27.3 ## 4 dose_2 VC 13.6 22.5 ## 5 dose_3 OJ 22.4 30.9 ## 6 dose_3 VC 18.5 33.9 library(ggplot2) ggplot()+ geom_errorbar(data=dat02.1, aes(x=dose, ymin=min_value, ymax=max_value), position = position_dodge(0.9), width=0.2)+ geom_boxplot(data=dat02,aes(x=dose,y=len,fill=supp), position = position_dodge(0.9)) 这种方式好像搞不定，这里我暂时想不到解决办法了，用另外一种方式吧 library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(tidyverse) library(ggplot2) ggplot(data=dat02,aes(x=dose,y=len,fill=supp))+ stat_boxplot(geom = &quot;errorbar&quot;, width=0.3, position = position_dodge(0.9))+ geom_boxplot(position = position_dodge(0.9)) 之前的作图函数介绍的都是geom_ 系列的函数，这里用到了stat_系列的函数 这个戏里的函数功能很强大，但是我平时用的不多，具体用法我也不太熟，这里就不过多介绍了 接下来是分组箱线图添加额外的注释信息，这个和上面介绍的普通柱形图是一样的 library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(tidyverse) library(ggplot2) ggplot(data=dat02,aes(x=dose,y=len,fill=supp))+ stat_boxplot(geom = &quot;errorbar&quot;, width=0.3, position = position_dodge(0.9))+ geom_boxplot(position = position_dodge(0.9))+ annotate(geom=&quot;text&quot;,x=1,y=25, label=&quot;Pvalue = 0.01&quot;,color=&quot;blue&quot;, fontface=&quot;italic&quot;)+ annotate(geom = &quot;segment&quot;, x = 0.6,y = 23, xend = 0.6,yend = 24, size=1)+ annotate(geom = &quot;segment&quot;, x = 0.6,y = 24, xend = 1.4,yend = 24, size=1)+ annotate(geom = &quot;segment&quot;, x = 1.4,y = 24, xend = 1.4,yend = 12, size=1) 5.3 接下来是小提琴图 小提琴图整体和箱线图的作图代码是一样 的，只需要我们把作图函数换成geom_violin() 用箱线图的数据来做演示 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_violin() 同样的可以更改边框 和填充颜色，如果四同意修改，就把参数写到aes()的外面，用真实颜色值，如果是根据不同的变量赋予不同的颜色就写到aes()的里面，用数据集的列名作为参数的值 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_violin(color=&quot;black&quot;,fill=&quot;grey&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_violin(aes(fill=var1)) 分组的小提琴图和箱线图的思路也是一样的 把上面分组箱线图的代码复制过来，把作图函数改成geom_violin() library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(ggplot2) ggplot(data=dat02,aes(x=dose,y=len,fill=supp))+ geom_violin() 如果要添加注释信息还是使用annotate()函数 还有一个比较常用的可视化方式是箱线图和小提琴图叠加到一起 library(readxl) dat02&lt;-read_excel(&quot;example_data/05-boxplot/dat02.xlsx&quot;) library(tidyverse) library(ggplot2) ggplot(data=dat02,aes(x=dose,y=len,fill=supp))+ geom_violin()+ stat_boxplot(geom = &quot;errorbar&quot;, width=0.3, position = position_dodge(0.9))+ geom_boxplot(position = position_dodge(0.9), width=0.2) 5.4 类似于箱线图/小提琴图的还有 抖动的散点图 geom_jitter() 蜂群图 需要借助额外的R包ggbeeswarm https://github.com/eclarke/ggbeeswarm 山脊图 借助额外的R包 ggridges https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html geom_jitter library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_jitter() ggplot(data=dat01,aes(x=var1,y=var2))+ geom_jitter(width=0.2,aes(color=var1)) 蜂群图 library(readxl) dat01&lt;-read_excel(&quot;example_data/05-boxplot/dat01_1.xlsx&quot;) head(dat01) ## # A tibble: 6 x 2 ## var1 var2 ## &lt;chr&gt; &lt;dbl&gt; ## 1 PAR_CH 0.571 ## 2 PAR_CH 0.432 ## 3 PAR_CH 0.645 ## 4 PAR_CH 0.590 ## 5 PAR_CH 0.740 ## 6 PAR_CH 0.591 library(ggplot2) library(ggbeeswarm) ## Warning: package &#39;ggbeeswarm&#39; was built under R version 4.0.5 ggplot(data=dat01,aes(x=var1,y=var2))+ geom_quasirandom() 这个点比较少可能看不出差别，我们用ggbeeswarm这个包帮助文档提供的例子看下 set.seed(12345) library(ggplot2) library(ggbeeswarm) #compare to jitter ggplot(iris,aes(Species, Sepal.Length)) + geom_jitter(color=&quot;red&quot;) ggplot(iris,aes(Species, Sepal.Length)) + geom_quasirandom(color=&quot;blue&quot;) 山脊图,这里直接用ggridges这个R包的帮助文档的例子 library(ggplot2) library(ggridges) ggplot(lincoln_weather, aes(x = `Mean Temperature [F]`, y = Month, fill = stat(x))) + geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) + scale_fill_viridis_c(name = &quot;Temp. [F]&quot;, option = &quot;C&quot;) + labs(title = &#39;Temperatures in Lincoln NE in 2016&#39;) ## Picking joint bandwidth of 3.37 最后是今天的实际例子，这个例子的代码来源于一篇Nature的论文 Environmental factors shaping the gut microbiome in a Dutch population dfToPlot&lt;-read.csv(&quot;example_data/05-boxplot/dfToPlot.csv&quot;) head(dfToPlot) ## BC_Spec BC_PWY BC_VF BC_CARD RELATIONSHIP.0 COHAB ## 1 0.5018598 0.1521802 0.8009368 0.7540197 RND.PAIR FALSE ## 2 0.6017878 0.1199416 0.9098667 0.6745180 RND.PAIR FALSE ## 3 0.6943654 0.1322052 0.8794888 0.4336659 PARTNERS TRUE ## 4 0.5504249 0.1195811 0.5355828 0.7883583 RND.PAIR FALSE ## 5 0.8220028 0.3994575 0.8408817 0.9276368 PAR_CH TRUE ## 6 0.7683990 0.3743061 0.9730157 0.9912979 RND.PAIR FALSE table(dfToPlot$RELATIONSHIP.0) ## ## PAR_CH PARTNERS RND.PAIR SIBL ## 285 1758 2000 144 dfToPlot$RELATIONSHIP.0 &lt;- factor(dfToPlot$RELATIONSHIP.0, levels=c(&quot;RND.PAIR&quot;,&quot;PARTNERS&quot;,&quot;PAR_CH&quot;,&quot;SIBL&quot;)) cbPalette &lt;- c(&quot;#E69F00&quot;, &quot;#CC79A7&quot;, &quot;#56B4E9&quot;, &quot;#009E73&quot;, &quot;#CC79A7&quot;, &quot;#F0E442&quot;, &quot;#999999&quot;,&quot;#0072B2&quot;,&quot;#D55E00&quot;) ggplot(data=dfToPlot,aes(x=RELATIONSHIP.0, y=BC_Spec, color=RELATIONSHIP.0))+ geom_jitter(alpha=0.2, position=position_jitterdodge(jitter.width = 0.35, jitter.height = 0, dodge.width = 0.8))+ geom_boxplot(alpha=0.2,width=0.45, position=position_dodge(width=0.8), size=0.75,outlier.colour = NA)+ geom_violin(alpha=0.2,width=0.9, position=position_dodge(width=0.8), size=0.75)+ scale_color_manual(values = cbPalette)+ theme_classic() + theme(legend.position=&quot;none&quot;) + theme(text = element_text(size=16)) + #ylim(0.0,1.3)+ ylab(&quot;Bray-Curtis distance of Species&quot;)+ #scale_x_discrete(labels=c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;))+ annotate(&quot;segment&quot;, x = 1-0.01, y = 1, xend = 2.01,lineend = &quot;round&quot;, yend = 1,size=1,colour=&quot;black&quot;,arrow = arrow(length = unit(0.02, &quot;npc&quot;)))+ annotate(&quot;segment&quot;, x = 2.01, y = 1, xend = 0.99,lineend = &quot;round&quot;, yend = 1,size=1,colour=&quot;black&quot;,arrow = arrow(length = unit(0.02, &quot;npc&quot;)))+ annotate(&quot;text&quot;, x=1.5,y=1.01, label=expression(&quot;**&quot;~&quot;FDR&quot;~2.41%*%10^-10),vjust=0) -&gt; p4 p4 ## Warning in is.na(x): is.na() applied to non-(list or vector) of type &#39;expression&#39; "],["r语言ggplot2折线图.html", "Chapter 6 R语言ggplot2折线图 6.1 最基本的折线图 6.2 分组的折线图 6.3 添加线段 6.4 添加辅助线 6.5 面积图 6.6 实际例子", " Chapter 6 R语言ggplot2折线图 这一章主要介绍R语言ggplot2画线的函数，我能想到的有 geom_line() geom_path() geom_vline() geom_hline() geom_abline() geom_curve() geom_segment() geom_area() 面积图也可以看成是折线图的一种吧 geom_ribbon() 6.1 最基本的折线图 准备数据 一列x和一列y,这里根据x是离散型数据还是连续型数据分为两种情况， 当x是连续型数据的时候 作图代码 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat01.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line() 线可以修改参数通常有 颜色 color 粗细 size 线型 lty 线型的种类可以参考这个链接 http://www.sthda.com/english/wiki/ggplot2-line-types-how-to-change-line-types-of-a-graph-in-r-software 比如 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat01.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line(color=&quot;red&quot;,size=5,lty=&quot;dashed&quot;) 这里我们看到x轴的刻度不是按照1到10这样截断的，如果要修改的话需要用到scale_x_continues()函数 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat01.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line(color=&quot;red&quot;,size=5,lty=&quot;dashed&quot;)+ scale_x_continuous(breaks = 1:10) 如果想要把散点也加上的话可以继续叠加geom_point()函数 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat01.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line()+ geom_point() 折线图还有一个比较常用的操作是添加误差线，添加误差线的函数是geom_errorbar(),假设我们已经提前算好数据整理到excel里,整理的数据如下 作图代码 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat02.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line()+ geom_point()+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value), width=0.2) 有时候可能还需要添加置信区间，添加置信区间的用geom_ribbon()函数，还是提前算好置信区间，数据集整理格式如下 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat02_1.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line()+ geom_point()+ geom_ribbon(aes(x=var1,ymin=lower95,ymax=upper95), fill=&quot;red&quot;,alpha=0.2) 以上是x轴是连续型数据的情况，接下来介绍x轴是离散型数据的情况 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat03.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line()+ geom_point() ## geom_path: Each group consists of only one observation. Do you need to adjust the group ## aesthetic? 以上代码画不出来线，离散型数据还需要我们指定一个group=1参数 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat03.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=1))+ geom_line()+ geom_point() 离散型数据比较常用的一个操作就是改变x轴的顺序，默认是按照首字母排序，如果想要按照我们自己要求的顺序来，我们给数据赋予因子水平 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat03.xlsx&quot;) dat01$var1&lt;-factor(dat01$var1, levels = c(&quot;B&quot;,&quot;D&quot;,&quot;C&quot;,&quot;A&quot;,&quot;E&quot;)) ggplot(data=dat01,aes(x=var1,y=var2,group=1))+ geom_line()+ geom_point() 这里需要注意的是赋予因子水平的时候levels参数后面跟的内容必须和数据里的字符完全一致，要不然会出现错误 以上的折线图在拐弯处都是很尖锐的，如果想要用平滑的线用ggplot2里的函数如何实现我暂时想不明白了，这里可以借助其他R包 ggbump 参考链接 https://github.com/davidsjoberg/ggbump 有时间可以自己研究一下，这里暂时不做介绍 6.2 分组的折线图 分组折线图需要在 x 和 y两列数据的基础上再增加一列表示分组，示例数据如下 作图代码 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat04.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=group))+ geom_line()+ geom_point() 用颜色 线型来区分不同的分组 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat04.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=group))+ geom_line(aes(color=group,lty=group))+ geom_point(aes(color=group,shape=group)) 分组数据添加误差线,再给数据集增加一列误差线数据 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat04_1.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=group))+ geom_line(aes(color=group,lty=group))+ geom_point(aes(color=group,shape=group))+ geom_errorbar(aes(ymin=var2-sd_value, ymax=var2+sd_value, color=group), width=0.2) 分组添加置信区间 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat04_2.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=group))+ geom_line(aes(color=group,lty=group))+ geom_point(aes(color=group,shape=group))+ geom_ribbon(aes(x=var1,ymin=lower95,ymax=upper95, color=group),alpha=0.2) 接下来是自定义这些 颜色 形状 等 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat04_2.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=group))+ geom_line(aes(color=group,lty=group))+ geom_point(aes(color=group,shape=group))+ geom_ribbon(aes(x=var1,ymin=lower95,ymax=upper95, color=group),alpha=0.2)+ scale_color_manual(values = c(&quot;group_1&quot;=&quot;blue&quot;,&quot;group_2&quot;=&quot;darkgreen&quot;)) x轴是离散数据的分组折线图,基本上和连续型的数据是一样的 示例数据集如下 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat05.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2,group=group))+ geom_line(aes(color=group,lty=group)) 折线图x轴是时间型数据，比如如下示例 这种情况我个人建议是给数据集增加一列连续型的数据用来做x，然后再修改x轴的坐标轴标签，比如把数据集改成如下 作图代码 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat06.xlsx&quot;, sheet = &quot;Sheet2&quot;) ggplot(data=dat01,aes(x=var3,y=var2))+ geom_line()+ scale_x_continuous(breaks = 1:5, labels = dat01$var1) 以上内容作图都是用到的geom_line()函数，接下来介绍geom_path()函数 参考 https://ggplot2.tidyverse.org/reference/geom_path.html library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat07.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_line()+ geom_point() ggplot(data=dat01,aes(x=var1,y=var2))+ geom_path()+ geom_point() 从上图我们可以看出来geom_line()函数是按照x数值的大小从前往后连，geom_path()函数是按照数据集出现的顺序连 6.3 添加线段 添加线段用到的函数是 geom_segment() 直线 geom_curve() 曲线 比如一个简单的数据集 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat08.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5) 在以上两个点之间添加一个线段 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat08.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5)+ geom_segment(aes(x=2,xend=4,y=2,yend=2)) 如果是曲线 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat08.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5)+ geom_curve(aes(x=2,xend=4,y=2,yend=2)) 曲线可以调节弧度,用到 curvature 参数 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat08.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5)+ geom_curve(aes(x=2,xend=4,y=2,yend=2),curvature = 0.2) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5)+ geom_curve(aes(x=2,xend=4,y=2,yend=2),curvature = -1) 添加箭头的话也是用到这两个函数 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat08.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5)+ geom_segment(aes(x=2,xend=4,y=2,yend=2), arrow = arrow()) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_point(size=5)+ geom_curve(aes(x=2,xend=4,y=2,yend=2),curvature = 0.2, arrow = arrow()) 6.4 添加辅助线 https://ggplot2.tidyverse.org/reference/geom_abline.html 垂直辅助线 geom_vline() 只需要指定xintercept 水平辅助线 geom_hline() 只需要指定yintercept 带有角度的线段 geom_abline() 需要指定截距 intercept 和斜率 slope 接下来用鸢尾花的数据集做一个演示 library(ggplot2) head(iris) ## Sepal.Length Sepal.Width Petal.Length Petal.Width Species ## 1 5.1 3.5 1.4 0.2 setosa ## 2 4.9 3.0 1.4 0.2 setosa ## 3 4.7 3.2 1.3 0.2 setosa ## 4 4.6 3.1 1.5 0.2 setosa ## 5 5.0 3.6 1.4 0.2 setosa ## 6 5.4 3.9 1.7 0.4 setosa ggplot(data=iris,aes(x=Sepal.Length,y=Sepal.Width))+ geom_point()+ geom_vline(xintercept = 6,size=1,lty=&quot;solid&quot;,color=&quot;red&quot;) ggplot(data=iris,aes(x=Sepal.Length,y=Sepal.Width))+ geom_point()+ geom_hline(yintercept = 3,size=1,lty=&quot;solid&quot;,color=&quot;red&quot;) ggplot(data=iris,aes(x=Sepal.Length, y=Sepal.Width))+ geom_point()+ geom_abline(intercept = 4, slope =-0.2 , size=1, lty=&quot;solid&quot;,color=&quot;red&quot;) 6.5 面积图 用最基本的折线图数据做一个演示 library(readxl) library(ggplot2) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat01.xlsx&quot;) ggplot(data=dat01,aes(x=var1,y=var2))+ geom_area() ggplot(data=dat01,aes(x=var1,y=var2))+ geom_area(fill=&quot;red&quot;,color=&quot;blue&quot;,alpha=0.2) 6.6 实际例子 library(pacman) ## Warning: package &#39;pacman&#39; was built under R version 4.0.5 p_load(tidyverse, showtext, ggtext) #eurovision_raw &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-17/eurovision.csv&#39;) #readr::write_csv(eurovision_raw,file = &quot;eurovision_raw.csv&quot;) eurovision_raw &lt;- readr::read_csv(&quot;example_data/06-lineplot/eurovision_raw.csv&quot;) ## Rows: 2005 Columns: 18 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (12): event, host_city, host_country, event_url, section, artist, song, artist_url, i... ## dbl (4): year, running_order, total_points, rank ## lgl (2): qualified, winner ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. eurovision &lt;- eurovision_raw %&gt;% filter(year &gt;= 2005, section == &quot;grand-final&quot;) # This is the first year where the &#39;grand-final&#39; happens # Analysis ---------------------------------------------------------------- highest_scores_by_rank &lt;- eurovision %&gt;% filter(rank &lt;= 3) %&gt;% group_by(rank) %&gt;% slice_max(total_points, n = 1) %&gt;% ungroup() %&gt;% select(year, artist_country, total_points) # Margin between 1st and 2nd eurovision %&gt;% select(rank, total_points, year) %&gt;% filter(rank &lt;= 2) %&gt;% group_by(year) %&gt;% arrange(rank) %&gt;% mutate(margin = total_points - lag(total_points)) %&gt;% ungroup() %&gt;% filter(rank == 2) %&gt;% slice_min(margin, n = 1) ## # A tibble: 1 x 4 ## rank total_points year margin ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 2 218 2009 -169 eurovision %&gt;% mutate(rank = factor(rank)) %&gt;% ggplot(aes(year, total_points, group = rank, color = rank)) + geom_line(data = eurovision %&gt;% filter(rank &gt; 3), color = &quot;grey75&quot;, size = .25, alpha = .5) + geom_line(data = eurovision %&gt;% filter(rank == 3), color = &quot;#0FB5AE&quot;, size = .75) + geom_line(data = eurovision %&gt;% filter(rank == 2), color = &quot;#4046CA&quot;, size = .75) + geom_line(data = eurovision %&gt;% filter(rank == 1), color = &quot;#F68511&quot;, size = .75) + geom_point(data = eurovision %&gt;% filter(year == 2017, rank == 1), shape = 21, color = &quot;white&quot;, fill = &quot;#F68511&quot; , size = 1.5) + geom_point(data = eurovision %&gt;% filter(year == 2009, rank == 1), shape = 21, color = &quot;white&quot;, fill = &quot;#F68511&quot; , size = 1.5) + geom_point(data = eurovision %&gt;% filter(year == 2009, rank == 2), shape = 21, color = &quot;white&quot;, fill = &quot;#4046CA&quot; , size = 1.5) + annotate(geom = &quot;segment&quot;, x = 2009, xend = 2009, y = 218 + 169, yend = 218, size = .1, color = &quot;black&quot;) + annotate(&quot;text&quot;, x = 2017, y = highest_scores_by_rank$total_points[1] + 30, label = highest_scores_by_rank$total_points[1], hjust = .5, color = &quot;#F68511&quot;, family = &quot;serif&quot;, fontface = &quot;bold&quot;, size = 6) + annotate(&quot;text&quot;, x = 2009.1, y = 218 + 169 + 30, label = 218 + 169, hjust = 0, color = &quot;#F68511&quot;, family = &quot;serif&quot;, fontface = &quot;bold&quot;, size = 6) + annotate(&quot;text&quot;, x = 2009.1, y = 218 + 30, label = 218, hjust = 0, color = &quot;#4046CA&quot;, family = &quot;serif&quot;, fontface = &quot;bold&quot;, size = 6) + coord_cartesian(expand = c(0, 0), ylim = c(0, 800)) + theme_minimal(base_family = &quot;serif&quot;) + labs(x = NULL, y = &quot;Total points&quot;, title = &quot;EUROVISION points are trending upwards&quot;, subtitle = &quot;The upward gradual trend reflects that countries need more points to come &lt;span style=&#39;color:#F68511&#39;&gt;**first**&lt;/span&gt;, &lt;span style=&#39;color:#4046CA&#39;&gt;**second**&lt;/span&gt;, and &lt;span style=&#39;color:#0FB5AE&#39;&gt;**third**&lt;/span&gt;&lt;br&gt;with each new edition&quot;, caption = &quot;Visualization by Pablo Alvarez | Data from Eurovision&quot; ) + theme( plot.margin = margin(rep(10, 4)), panel.grid = element_blank(), panel.grid.major = element_line(size = .15, color = &quot;grey75&quot;), plot.background = element_rect(fill = &quot;grey90&quot;, color = &quot;grey90&quot;), panel.background = element_rect(fill = &quot;grey90&quot;, color = &quot;grey90&quot;), axis.title.y = element_text(angle = 90, hjust = .99, size = 16.5, color = &quot;grey25&quot;), axis.title.x = element_text(hjust = 0, size = 20, color = &quot;grey15&quot;), axis.text = element_text(size = 16, color = &quot;grey50&quot;), axis.line = element_line(color = &quot;grey75&quot;, size = .15), plot.title = element_text(size = 32, color = &quot;black&quot;, family = &quot;serif&quot;, hjust = 0), plot.subtitle = element_markdown(size = 16, color = &quot;black&quot;, family = &quot;serif&quot;, hjust = 0, margin = margin(b = 20, t = 1), lineheight = .35), plot.caption = element_text(size = 18, color = &quot;grey50&quot;, hjust = 0, margin = margin(t = 20), lineheight = .3) ) ## Warning in if (!expand) {: the condition has length &gt; 1 and only the first element will be ## used ## Warning in if (!expand) {: the condition has length &gt; 1 and only the first element will be ## used "],["r语言ggplot2饼状图.html", "Chapter 7 R语言ggplot2饼状图 7.1 最基本的饼状图 7.2 中间空心的饼状图 7.3 其他效果的饼状图 7.4 其中某一块可以离开的饼图 7.5 多层嵌套的饼状图 7.6 一次性画很多个饼状图 7.7 饼状图的两个实例", " Chapter 7 R语言ggplot2饼状图 饼状图主要用来展示比例，R语言ggplot2包好像没有专门画饼状图的函数，ggplot2的实现方式是先画堆积柱形图，然后再极坐标的形式转换成饼图，这里极坐标具体的含义我也不懂，这里先记住这个名词 7.1 最基本的饼状图 最基本的数据格式如下 第一列是变量的名字，第二列是变量的数值，这里数值可以先不用转换成比例 作图代码 参考链接 http://www.sthda.com/english/wiki/ggplot2-pie-chart-quick-start-guide-r-software-and-data-visualization 堆积柱形图代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1) 加上极坐标转换成饼状图 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=20) start参数可以让饼状图顺时针或者逆时针旋转 饼状图最常用的一个操作是在给个部分添加上文字展示真实的比例值，这里我们使用annotate()函数,这个比例值需要自己先算一下 这里需要注意的一个地方是坐标，原来的坐标跟极坐标之间是如何转化的我还没有搞明白，我的做法是先随便指定一个位置，然后根据这个文本在图中出现的位置然后调试 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;) 然后是自定义颜色 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#7f7f7f&quot;, &quot;B&quot;=&quot;#fe0904&quot;, &quot;D&quot;=&quot;#f9b54f&quot;)) 饼状图的文本一种比较方便的处理方式是直接添加到图例的文本位置上 修改图例的文本，可以在自定义颜色的参数里添加上labels参数 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#7f7f7f&quot;, &quot;B&quot;=&quot;#fe0904&quot;, &quot;D&quot;=&quot;#f9b54f&quot;), labels=c(&quot;A&quot;= &quot;A (20%)&quot;, &quot;B&quot; = &quot;B (30%)&quot;, &quot;D&quot; = &quot;D (50%)&quot;)) 饼状图通常是没有背后的灰色背景之类的，通过设置主题把这些全部去掉 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#7f7f7f&quot;, &quot;B&quot;=&quot;#fe0904&quot;, &quot;D&quot;=&quot;#f9b54f&quot;))+ theme_void() 以上是最基本的饼状图 7.2 中间空心的饼状图 通过设置x坐标的范围来实现其中的空心效果 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#7f7f7f&quot;, &quot;B&quot;=&quot;#fe0904&quot;, &quot;D&quot;=&quot;#f9b54f&quot;))+ theme_void()+ xlim(0,NA) 7.3 其他效果的饼状图 上面极坐标的参数是y,如果把参数改成x library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,width=1)+ coord_polar(&quot;x&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#7f7f7f&quot;, &quot;B&quot;=&quot;#fe0904&quot;, &quot;D&quot;=&quot;#f9b54f&quot;))+ theme_void() 普通的柱形图加上极坐标转化的效果 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) library(ggplot2) ggplot(data=dat01,aes(x=var1,y=var2,fill=var1))+ geom_bar(stat=&quot;identity&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0)+ annotate(geom = &quot;text&quot;,x=1,y=90,label=&quot;20%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=60,label=&quot;30%&quot;)+ annotate(geom = &quot;text&quot;,x=1,y=20,label=&quot;50%&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#7f7f7f&quot;, &quot;B&quot;=&quot;#fe0904&quot;, &quot;D&quot;=&quot;#f9b54f&quot;))+ theme_void() 以上文本位置都对不上，需要我们单独调节 7.4 其中某一块可以离开的饼图 这个用ggplot2如何实现我暂时想不到，这里需要借助另外的R包ggforce,大家如果想要这种效果的话可以参考一下这个视频 https://www.bilibili.com/video/BV1Sa411w7cP?spm_id_from=333.999.0.0 这里就不介绍代码了 7.5 多层嵌套的饼状图 多层嵌套的饼状图和一组的思路是一样的，我们多准备几组数据既可以了 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) dat02&lt;-read_excel(&quot;example_data/07-pieplot/dat02.xlsx&quot;) library(ggplot2) ggplot()+ geom_bar(data=dat01,aes(x=1,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=0.5)+ geom_bar(data=dat02,aes(x=2,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0) 第二组数据里如果没有其中某个变量就会空白出来一部分 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) dat03&lt;-read_excel(&quot;example_data/07-pieplot/dat03.xlsx&quot;) library(ggplot2) ggplot()+ geom_bar(data=dat01,aes(x=1,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=0.5)+ geom_bar(data=dat03,aes(x=2,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0) 叠加三组数据 library(readxl) dat01&lt;-read_excel(&quot;example_data/07-pieplot/dat01.xlsx&quot;) dat03&lt;-read_excel(&quot;example_data/07-pieplot/dat03.xlsx&quot;) dat04&lt;-read_excel(&quot;example_data/07-pieplot/dat04.xlsx&quot;) library(ggplot2) ggplot()+ geom_bar(data=dat01,aes(x=1,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=0.5)+ geom_bar(data=dat03,aes(x=2,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ geom_bar(data=dat04,aes(x=3,y=var2,fill=var1), stat=&quot;identity&quot;,position = &quot;stack&quot;,width=1)+ coord_polar(&quot;y&quot;, start=0) 7.6 一次性画很多个饼状图 这个用ggplot2如何实现我暂时也想不到了，这里借助额外的R包scatterpie,这里用之前B站录制过的视频介绍 https://www.bilibili.com/video/BV1nb4y1f75k?spm_id_from=333.999.0.0 示例数据集如下 df&lt;-read.csv(&quot;example_data/07-pieplot/mutilpie_example.csv&quot;,header=T) df ## x y A B ## 1 2 2 8 92 ## 2 4 2 96 4 ## 3 6 2 22 78 ## 4 8 2 35 65 ## 5 10 2 41 59 ## 6 12 2 80 20 ## 7 14 2 3 97 ## 8 2 4 86 14 ## 9 4 4 57 43 ## 10 6 4 10 90 ## 11 8 4 55 45 ## 12 10 4 98 2 ## 13 12 4 25 75 ## 14 14 4 94 6 ## 15 2 6 83 17 ## 16 4 6 50 50 ## 17 6 6 70 30 ## 18 8 6 20 80 ## 19 10 6 99 1 ## 20 12 6 63 37 ## 21 14 6 71 29 ## 22 2 8 61 39 ## 23 4 8 51 49 ## 24 6 8 84 16 ## 25 8 8 27 73 ## 26 10 8 72 28 ## 27 12 8 48 52 ## 28 14 8 60 40 #install.packages(&quot;scatterpie&quot;) library(scatterpie) ## Warning: package &#39;scatterpie&#39; was built under R version 4.0.5 library(ggplot2) ggplot()+ geom_scatterpie(data=df, aes(x,y,r=0.9), cols = c(&quot;A&quot;,&quot;B&quot;))+ coord_equal()+ theme_void()+ theme(legend.position = &quot;none&quot;)+ scale_fill_manual(values = c(&quot;#5b9bd5&quot;,&quot;#e64b35&quot;)) 7.7 饼状图的两个实例 数据代码来源 https://github.com/jack-davison/TidyTuesday/blob/master/R/2021_02_16_dubois.R library(tidyverse) library(cowplot) tuesdata_occupation &lt;- readr::read_csv(&quot;example_data/07-pieplot/20220530_piechart.csv&quot;) ## Rows: 10 Columns: 3 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (2): Group, Occupation ## dbl (1): Percentage ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. dat = tuesdata_occupation %&gt;% janitor::clean_names() %&gt;% mutate(plot_perc = percentage / sum(percentage)) %&gt;% mutate(plot_perc = (plot_perc * 61)/100) %&gt;% bind_rows(tibble(group = c(&quot;Negroes&quot;, &quot;Whites&quot;), occupation = c(&quot;empty&quot;, &quot;empty&quot;), percentage = c(0,0), plot_perc = c(0.195, 0.195))) %&gt;% mutate(occupation = factor(occupation, levels = c(&quot;Agriculture, Fisheries and Mining&quot;, &quot;Domestic and Personal Service&quot;, &quot;Manufacturing and Mechanical Industries&quot;, &quot;Trade and Transportation&quot;, &quot;Professions&quot;, &quot;Empty&quot;))) %&gt;% arrange(desc(group), occupation) %&gt;% mutate(ypos = cumsum(plot_perc)- 0.5*plot_perc) %&gt;% arrange(occupation) ## Warning in FUN(X[[i]], ...): strings not representable in native encoding will be translated ## to UTF-8 ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00C4&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00D6&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00E4&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00F6&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00DF&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00C6&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00E6&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00D8&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00F8&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00C5&gt;&#39; to native encoding ## Warning in FUN(X[[i]], ...): unable to translate &#39;&lt;U+00E5&gt;&#39; to native encoding lab_dat = dat %&gt;% select(occupation) %&gt;% distinct() %&gt;% drop_na() %&gt;% mutate(x = c(-1.5, 1.5, -1.5, 1.5, 1.5), y = c(4, 5, 2, 1, 3), occupation = case_when( occupation == &quot;Agriculture, Fisheries and Mining&quot; ~ &quot;AGRICULTURE, FISHERIES\\nAND MINING.&quot;, occupation == &quot;Domestic and Personal Service&quot; ~ &quot;DOMESTIC AND\\nPERSONAL SERVICE.&quot;, occupation == &quot;Manufacturing and Mechanical Industries&quot; ~ &quot;MANUFACTURING AND\\nMECHANICAL INDUSTRIES.&quot;, occupation == &quot;Trade and Transportation&quot; ~ &quot;TRADE AND\\nTRANSPORTATION.&quot;, occupation == &quot;Professions&quot; ~ &quot;PROFESSIONS.&quot; )) dat ## # A tibble: 12 x 5 ## group occupation percentage plot_perc ypos ## &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Whites Agriculture, Fisheries and Mining 64 0.196 0.0979 ## 2 Negroes Agriculture, Fisheries and Mining 62 0.190 0.593 ## 3 Whites Domestic and Personal Service 5.5 0.0168 0.204 ## 4 Negroes Domestic and Personal Service 28 0.0857 0.731 ## 5 Whites Manufacturing and Mechanical Industries 12.5 0.0383 0.232 ## 6 Negroes Manufacturing and Mechanical Industries 5 0.0153 0.781 ## 7 Whites Trade and Transportation 13 0.0398 0.271 ## 8 Negroes Trade and Transportation 4.5 0.0138 0.796 ## 9 Whites Professions 4 0.0122 0.297 ## 10 Negroes Professions 0.8 0.00245 0.804 ## 11 Whites &lt;NA&gt; 0 0.195 0.401 ## 12 Negroes &lt;NA&gt; 0 0.195 0.902 pie = ggplot(dat, aes(y = &quot;&quot;, x = plot_perc, fill = occupation, group = group)) + geom_col(aes(color = occupation == &quot;empty&quot;)) + coord_polar(start = pi - (55*pi)/180) + scale_fill_manual(values = c(&quot;#b8243c&quot;, &quot;#f2c50a&quot;, &quot;#5a6796&quot;, &quot;#d5c8b7&quot;, &quot;#ab927a&quot;), na.translate = F) + theme_void() + theme(legend.position = &quot;none&quot;, plot.background = element_rect(color = NA, fill = &quot;#ece5d5&quot;), text = element_text(family = &quot;mono&quot;), plot.title = element_text(hjust = .5, face = &quot;bold&quot;), plot.margin = unit(rep(.5,4), &quot;cm&quot;)) + geom_text(aes(x = ypos, label = ifelse(occupation == &quot;empty&quot;, NA, glue::glue(&quot;{round(percentage,1)}%&quot;))), nudge_y = .35, family = &quot;mono&quot;) + annotate(geom = &quot;text&quot;, x = 0.65, y = 1.5, label = &quot;NEGROES.&quot;, family = &quot;mono&quot;) + annotate(geom = &quot;text&quot;, x = 0.15, y = 1.5, label = &quot;WHITES.&quot;, family = &quot;mono&quot;) + scale_color_manual(values = c(&quot;#5f4e3b&quot;, NA)) + guides(color = guide_none()) + labs(title = &quot;OCCUPATIONS OF NEGROES AND WHITES IN GEORGIA.&quot;) pie ## Warning: Removed 2 rows containing missing values (geom_text). legend = ggplot(lab_dat, aes(x,y, fill = occupation)) + geom_point(shape = 21, size = 10) + geom_text(data = lab_dat %&gt;% filter(x == -1.5), aes(label = occupation), nudge_x = .55, family = &quot;mono&quot;, size = 3) + geom_text(data = lab_dat %&gt;% filter(x == 1.5), aes(label = occupation), nudge_x = -.4, family = &quot;mono&quot;, size = 3) + scale_fill_manual(values = c(&quot;#b8243c&quot;, &quot;#f2c50a&quot;, &quot;#5a6796&quot;, &quot;#d5c8b7&quot;, &quot;#ab927a&quot;), na.translate = F) + theme_void() + theme(text = element_text(family = &quot;mono&quot;), legend.position = &quot;none&quot;, aspect.ratio = .3) + coord_cartesian(clip = &quot;off&quot;) ggdraw(plot = pie) + draw_plot(legend, scale = .7) ## Warning: Removed 2 rows containing missing values (geom_text). 第二个实例 数据代码来源 https://github.com/etmckinley/Tidy-Tuesday/blob/main/30%20Day%20Chart%20Challenge/2022/1/1-%20passing%20feet.R library(tidyverse) library(gggibbous) ## Warning: package &#39;gggibbous&#39; was built under R version 4.0.5 team_passing&lt;-readr::read_csv(&quot;example_data/07-pieplot/20220530_piechart_01.csv&quot;) ## Rows: 125 Columns: 7 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (2): Squad, Comp ## dbl (5): Season_End_Year, Left, Right, total, ratio ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. team_info&lt;-readr::read_csv(&quot;example_data/07-pieplot/team_info.csv&quot;) ## Rows: 467 Columns: 27 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (26): team_name, Squad, team_short_name, team_abbreviation, alt_abbreviation, league,... ## dbl (1): team_id ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. limits=c(0,2) team_passing %&gt;% filter(Comp == &quot;Premier League&quot;) %&gt;% left_join(team_info %&gt;% select(Squad, Primary, Secondary)) %&gt;% #bind_rows(team_passing %&gt;% # filter(Comp == &quot;Premier League&quot;) %&gt;% # mutate(ratio=1)) %&gt;% ggplot()+ geom_moon(aes(ratio=ratio, fill=Secondary), x=1, y=1, right=FALSE, size=20)+ geom_moon(aes(ratio=1-ratio, fill=Primary), x=1, y=1, right=TRUE, size=20)+ geom_text(aes(label = paste0(format(round((1-ratio)*100,1), nsmall=1), &quot;%&quot;)), x=1.25, y=1, size=2, family=&quot;serif&quot;, color=&quot;white&quot;)+ coord_cartesian(xlim=limits, ylim=limits)+ facet_wrap(~reorder(Squad,-ratio),ncol = 8)+ scale_fill_identity()+ theme_void()+ theme(legend.position = &quot;none&quot;, #text=element_text(size=40, family = &quot;serif&quot;), #plot.caption=element_text(size=14), #plot.subtitle = element_text(size=18), plot.margin = margin(.2,.2,.2,.2, unit=&quot;in&quot;))+ labs(title= &quot;What foot do Premier League teams pass with?&quot;, subtitle= &quot;2021-2022 Premier League season\\n&quot;, caption= &quot;Plot: @etmckinley | data: StatsBomb via FBRef and {worldfootballr}&quot;) ## Joining, by = &quot;Squad&quot; "],["r语言ggplot2热图.html", "Chapter 8 R语言ggplot2热图 8.1 pheatmap热图 8.2 ggplot2热图 8.3 ggplot2气泡热图图 8.4 一个完整的例子", " Chapter 8 R语言ggplot2热图 8.1 pheatmap热图 R语言里做热图最快捷的方式是用pheatmap这个R包,优点是用非常少的代码就可以出一个比较好看的图，缺点是细节修改不是很方便，比如要用热图展示基因表达量的数据，准备数据的格式如下 pheatmap不是R语言自带的R包，第一次使用需要先安装,安装直接使用命令install.packages(\"pheatmap\") 读取数据 library(readxl) dat01&lt;-read_excel(&quot;example_data/06-lineplot/dat08.xlsx&quot;) 这里需要注意的 一个点是热图数据通常需要把第一列的基因名作为整个数据的行名，但是读取excel的函数好像没有指定列为行名的函数，当然可以将数据集读取进来以后再进行转换，另外一种方式就是把数据另存为csv格式，然后用读取csv格式数据的函数 这里需要注意的一点是转换为csv格式的时候选择如下截图中的2，不要选择1 读取csv格式数据 dat01&lt;-read.delim(file = &quot;example_data/08-heatmap/01pheatmap_example.csv&quot;, header=TRUE, sep=&quot;,&quot;, row.names = 1) 作图代码 dat01&lt;-read.delim(file = &quot;example_data/08-heatmap/01pheatmap_example.csv&quot;, header=TRUE, sep=&quot;,&quot;, row.names = 1) library(pheatmap) pheatmap(dat01) 如果要在色块上添加文本，再单独准备一个和热图数据格式一样的数据，然后用display_numbers参数添加文本,这里我就直接使用热图的数据 dat01&lt;-read.delim(file = &quot;example_data/08-heatmap/01pheatmap_example.csv&quot;, header=TRUE, sep=&quot;,&quot;, row.names = 1) library(pheatmap) pheatmap(dat01) pheatmap(dat01, display_numbers = dat01) 以上是对pheatmap这个R包的简要介绍 ggplot2也有直接做热图的函数 geom_tile(),ggplot2做热图可能代码稍微繁琐，但是优点是细节调整方便，基本上所有的细节都可以用代码来调整 ggplot2做热图还需要掌握的一个知识点是 长格式数据 和 宽格式 数据，ggplot2作图的输入数据都是长格式数据，长格式数据如下，一列x，一列y，还有一个数据 宽格式数据截图如下 这个长宽格式转化是ggplot2作图必须理解的一个概念 R语言里提供了长宽格式数据互相转化的函数，这里我以tidyverse这个R包里的函数作为介绍，tidyverse主要是用来在数据处理的，也不是R语言自带的R包，需要运行安装命令install.packages(\"tidyverse\") 宽格式数据转换为长格式用到的函数是pivot_longer() 转换代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/02_wide_data.xlsx&quot;) head(dat01) ## # A tibble: 2 x 3 ## gene_name sample1 sample2 ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 gene1 4 3 ## 2 gene2 5 4 library(tidyverse) dat01 %&gt;% pivot_longer(-gene_name,names_to = &quot;A&quot;,values_to = &quot;B&quot;) ## # A tibble: 4 x 3 ## gene_name A B ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene1 sample1 4 ## 2 gene1 sample2 3 ## 3 gene2 sample1 5 ## 4 gene2 sample2 4 长格式转换为宽格式的函数是pivot_wider() 转换代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/02_long_data.xlsx&quot;) head(dat01) ## # A tibble: 4 x 3 ## x y value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene1 sample1 3 ## 2 gene1 sample2 4 ## 3 gene2 sample1 5 ## 4 gene2 sample2 6 library(tidyverse) dat01 %&gt;% pivot_wider(names_from = y,values_from = value) ## # A tibble: 2 x 3 ## x sample1 sample2 ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 gene1 3 4 ## 2 gene2 5 6 这个是最基本的长宽格式数据转换，如果数据集有很多列，有时候转换会相对比较复杂，这里就不做介绍，因为我也搞不懂有时候 8.2 ggplot2热图 以下介绍ggplot2做热图的代码都是假设已经拿到了长格式数据 示例数据如下 最基本的热图代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 library(ggplot2) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=NA) 热图经常遇到的操作是调整坐标轴的顺序，这个可以通过赋予因子水平来实现 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;) dat01$Sample&lt;-factor(dat01$Sample, levels = c(&quot;sample_2&quot;,&quot;sample_4&quot;,&quot;sample_6&quot;, &quot;sample_1&quot;,&quot;sample_3&quot;,&quot;sample_5&quot;)) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;) 更改热图色块填充的颜色 更改热图填充颜色有很多种方式，这里我介绍我自己最常用的一种方式 参考链接 https://r-charts.com/ 这里用到额外的一个R包 paletteer https://github.com/EmilHvitfeldt/paletteer library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;) library(paletteer) ## Warning: package &#39;paletteer&#39; was built under R version 4.0.5 ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1) 调整坐标轴文本标签的位置，y轴左右，x轴是上下 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_x_discrete(position = &quot;top&quot;)+ scale_y_discrete(position = &quot;right&quot;) 调整坐标轴的文本方向 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_x_discrete(position = &quot;top&quot;)+ scale_y_discrete(position = &quot;right&quot;)+ theme(axis.text.x = element_text(angle=60)) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_x_discrete(position = &quot;top&quot;)+ scale_y_discrete(position = &quot;right&quot;)+ theme(axis.text.x = element_text(angle=60,hjust=0,vjust=1)) 去掉整个的灰色背景和坐标轴的小短线 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_x_discrete(position = &quot;top&quot;)+ scale_y_discrete(position = &quot;right&quot;)+ theme(axis.text.x = element_text(angle=60,hjust=0,vjust=1), axis.ticks = element_blank(), panel.background = element_blank()) 如果看起来坐标轴的文本距离图比较远的话还可以调整 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_x_discrete(position = &quot;top&quot;, expand = expansion(mult = c(0,0)))+ scale_y_discrete(position = &quot;right&quot;, expand = expansion(mult = c(0,0)))+ theme(axis.text.x = element_text(angle=60,hjust=0,vjust=1), axis.ticks = element_blank(), panel.background = element_blank()) 在色块上添加文本，用geom_text()函数来添加 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_x_discrete(position = &quot;top&quot;, expand = expansion(mult = c(0,0)))+ scale_y_discrete(position = &quot;right&quot;, expand = expansion(mult = c(0,0)))+ theme(axis.text.x = element_text(angle=60,hjust=0,vjust=1), axis.ticks = element_blank(), panel.background = element_blank())+ geom_text(aes(label=expr_value)) 调整图例的细节 参考公众号推文 ggplot2画热图展示相关系数的简单小例子 截断和标签是在scale_fill函数里设置breaks和labels 图例的位置是在主题里进行设置 其他一些细节在guides函数里设置 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr_value),color=&quot;red&quot;)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1, breaks=c(1.1,3,5,7,9,9.9), labels=c(1,3,5,7,9,10))+ scale_x_discrete(position = &quot;top&quot;, expand = expansion(mult = c(0,0)))+ scale_y_discrete(position = &quot;right&quot;, expand = expansion(mult = c(0,0)))+ theme(axis.text.x = element_text(angle=60,hjust=0,vjust=1), axis.ticks = element_blank(), panel.background = element_blank())+ geom_text(aes(label=expr_value))+ theme(legend.position = &quot;top&quot;)+ guides(fill=guide_colorbar(title = &quot;AAA&quot;, title.position = &quot;top&quot;, title.hjust = 0.5, barwidth = 20, ticks = FALSE, label = TRUE)) 以上介绍的用来填充颜色的数据是连续型的，数据是离散的也是可以的，比如只关心某个基因在样本中是否表达，并不关心这个基因的表达量高低,示例数据如下 这里A代表基因表达B代表基因不表达，这个AB可以用任意字符代替 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/04_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 gene_1 sample_1 B ## 2 gene_1 sample_2 B ## 3 gene_1 sample_3 B ## 4 gene_1 sample_4 A ## 5 gene_1 sample_5 A ## 6 gene_1 sample_6 A dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr),color=&quot;blue&quot;) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr),color=&quot;blue&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#fe0904&quot;, &quot;B&quot;=&#39;#f9b54f&#39;)) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_tile(aes(fill=expr),color=&quot;blue&quot;)+ scale_fill_manual(values = c(&quot;A&quot;=&quot;#fe0904&quot;, &quot;B&quot;=&#39;white&#39;))+ theme_bw() 8.3 ggplot2气泡热图图 如果x 和 y都是离散的，把热图函数geom_tile()换成geom_point()函数，然后用表达量的值映射点的大小 同时映射颜色 也可以归为热图的一种 比如 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_point(aes(fill=expr_value, size=expr_value),color=&quot;blue&quot;,shape=21) 更改默认的配色和点的大小 library(readxl) dat01&lt;-read_excel(&quot;example_data/08-heatmap/03_heatmap_example.xlsx&quot;) head(dat01) ## # A tibble: 6 x 3 ## gene_name Sample expr_value ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 gene_1 sample_1 1 ## 2 gene_1 sample_2 5 ## 3 gene_1 sample_3 8 ## 4 gene_1 sample_4 4 ## 5 gene_1 sample_5 2 ## 6 gene_1 sample_6 5 dat01$gene_name&lt;-factor(dat01$gene_name, levels = c(&quot;gene_1&quot;,&quot;gene_2&quot;,&quot;gene_3&quot;, &quot;gene_4&quot;,&quot;gene_5&quot;,&quot;gene_6&quot;, &quot;gene_7&quot;,&quot;gene_8&quot;,&quot;gene_9&quot;, &quot;gene_10&quot;)) library(ggplot2) library(paletteer) ggplot(data=dat01,aes(x=gene_name,y=Sample))+ geom_point(aes(fill=expr_value, size=expr_value),color=&quot;blue&quot;,shape=21)+ scale_fill_paletteer_c(&quot;ggthemes::Classic Orange-White-Blue&quot;, direction = -1)+ scale_size_continuous(range = c(1,20), guide = guide_legend(override.aes = list(size = c(1,2,3,5)) )) 8.4 一个完整的例子 来源 https://www.royfrancis.com/a-guide-to-elegant-tiled-heatmaps-in-r-2019/ library(reshape2) ## ## Attaching package: &#39;reshape2&#39; ## The following object is masked from &#39;package:tidyr&#39;: ## ## smiths library(ggplot2) m &lt;- read.csv(&quot;example_data/08-heatmap/measles_lev1.txt&quot;, header = T, stringsAsFactors = F, skip = 2) m2 &lt;- melt(m,id.vars = c(&quot;YEAR&quot;, &quot;WEEK&quot;)) #rename column names colnames(m2) &lt;- c(&quot;Year&quot;, &quot;Week&quot;, &quot;State&quot;, &quot;Value&quot;) #inspect data head(m2) ## Year Week State Value ## 1 1928 1 ALABAMA 3.67 ## 2 1928 2 ALABAMA 6.25 ## 3 1928 3 ALABAMA 7.95 ## 4 1928 4 ALABAMA 12.58 ## 5 1928 5 ALABAMA 8.03 ## 6 1928 6 ALABAMA 7.27 table(m2$State) ## ## ALABAMA ALASKA ARIZONA ARKANSAS ## 3952 3952 3952 3952 ## CALIFORNIA COLORADO CONNECTICUT DELAWARE ## 3952 3952 3952 3952 ## DISTRICT.OF.COLUMBIA FLORIDA GEORGIA HAWAII ## 3952 3952 3952 3952 ## IDAHO ILLINOIS INDIANA IOWA ## 3952 3952 3952 3952 ## KANSAS KENTUCKY LOUISIANA MAINE ## 3952 3952 3952 3952 ## MARYLAND MASSACHUSETTS MICHIGAN MINNESOTA ## 3952 3952 3952 3952 ## MISSISSIPPI MISSOURI MONTANA NEBRASKA ## 3952 3952 3952 3952 ## NEVADA NEW.HAMPSHIRE NEW.JERSEY NEW.MEXICO ## 3952 3952 3952 3952 ## NEW.YORK NORTH.CAROLINA NORTH.DAKOTA OHIO ## 3952 3952 3952 3952 ## OKLAHOMA OREGON PENNSYLVANIA RHODE.ISLAND ## 3952 3952 3952 3952 ## SOUTH.CAROLINA SOUTH.DAKOTA TENNESSEE TEXAS ## 3952 3952 3952 3952 ## UTAH VERMONT VIRGINIA WASHINGTON ## 3952 3952 3952 3952 ## WEST.VIRGINIA WISCONSIN WYOMING ## 3952 3952 3952 camelCase &lt;- function(string=NULL,separator=&quot;\\\\.&quot;){ if(is.null(string)) stop(&quot;No input string.n&quot;) s &lt;- strsplit(string, separator) s &lt;- tolower(s[[1]]) paste(toupper(substring(s, 1, 1)), substring(s, 2),sep = &quot;&quot;, collapse = &quot; &quot;) } #change variable to character, convert to camel case, #remove dot and change variable back to factor m2$State &lt;- factor(as.character(sapply(as.character(m2$State),camelCase))) m2$Year &lt;- factor(m2$Year) m2$Week &lt;- factor(m2$Week) #also converts &#39;-&#39; to NA m2$Value &lt;- as.numeric(m2$Value) ## Warning: NAs introduced by coercion naSum &lt;- function(x) { if(all(is.na(x))) val &lt;- sum(x,na.rm=F) if(!all(is.na(x))) val &lt;- sum(x,na.rm=T) return(val) } #sums incidences for all weeks into one year m3 &lt;- plyr::ddply(m2,c(&quot;Year&quot;,&quot;State&quot;),Incidence=round(naSum(Value),0),plyr::summarise) #inspect data head(m3) ## Year State Incidence ## 1 1928 Alabama 335 ## 2 1928 Alaska NA ## 3 1928 Arizona 201 ## 4 1928 Arkansas 482 ## 5 1928 California 69 ## 6 1928 Colorado 207 str(m3) ## &#39;data.frame&#39;: 3876 obs. of 3 variables: ## $ Year : Factor w/ 76 levels &quot;1928&quot;,&quot;1929&quot;,..: 1 1 1 1 1 1 1 1 1 1 ... ## $ State : Factor w/ 51 levels &quot;Alabama&quot;,&quot;Alaska&quot;,..: 1 2 3 4 5 6 7 8 9 10 ... ## $ Incidence: num 335 NA 201 482 69 207 635 256 536 120 ... m3$State &lt;- factor(as.character(m3$State),levels=rev(levels(m3$State))) #create a new variable from incidence m3$IncidenceFactor &lt;- cut(m3$Incidence, breaks = c(-1,0,1,10,100,500,1000,max(m3$Incidence,na.rm=T)), labels=c(&quot;0&quot;,&quot;0-1&quot;,&quot;1-10&quot;,&quot;10-100&quot;,&quot;100-500&quot;,&quot;500-1000&quot;,&quot;&gt;1000&quot;)) #change level order m3$IncidenceFactor &lt;- factor(as.character(m3$IncidenceFactor), levels=rev(levels(m3$IncidenceFactor))) textcol &lt;- &quot;grey40&quot; #modified ggplot p &lt;- ggplot(m3,aes(x=Year,y=State,fill=IncidenceFactor))+ geom_tile()+ #redrawing tiles to remove cross lines from legend geom_tile(colour=&quot;white&quot;,size=0.25, show_guide=FALSE)+ #remove axis labels, add title labs(x=&quot;&quot;,y=&quot;&quot;,title=&quot;Incidence of Measles in the US&quot;)+ #remove extra space scale_y_discrete(expand=c(0,0))+ #custom breaks on x-axis scale_x_discrete(expand=c(0,0), breaks=c(&quot;1930&quot;,&quot;1940&quot;,&quot;1950&quot;,&quot;1960&quot;,&quot;1970&quot;,&quot;1980&quot;,&quot;1990&quot;,&quot;2000&quot;))+ #custom colours for cut levels and na values scale_fill_manual(values=c(&quot;#d53e4f&quot;,&quot;#f46d43&quot;,&quot;#fdae61&quot;, &quot;#fee08b&quot;,&quot;#e6f598&quot;,&quot;#abdda4&quot;,&quot;#ddf1da&quot;),na.value=&quot;grey90&quot;)+ #mark year of vaccination geom_vline(aes(xintercept = 36),size=3.4,alpha=0.24)+ #equal aspect ratio x and y axis #coord_fixed()+ #set base size for all font elements theme_grey(base_size=10)+ #theme options theme( #remove legend title legend.title=element_blank(), #remove legend margin legend.margin = grid::unit(0,&quot;cm&quot;), #change legend text properties legend.text=element_text(colour=textcol,size=7,face=&quot;bold&quot;), #change legend key height legend.key.height=grid::unit(0.8,&quot;cm&quot;), #set a slim legend legend.key.width=grid::unit(0.2,&quot;cm&quot;), #set x axis text size and colour axis.text.x=element_text(size=10,colour=textcol), #set y axis text colour and adjust vertical justification axis.text.y=element_text(vjust = 0.2,colour=textcol,size=4), #change axis ticks thickness axis.ticks=element_line(size=0.4), #change title font, size, colour and justification plot.title=element_text(colour=textcol,hjust=0,size=14,face=&quot;bold&quot;), #remove plot background plot.background=element_blank(), #remove plot border panel.border=element_blank()) ## Warning: `show_guide` has been deprecated. Please use `show.legend` instead. ## Warning: `legend.margin` must be specified using `margin()`. For the old behavior use ## legend.spacing p library(RColorBrewer) ## Warning: package &#39;RColorBrewer&#39; was built under R version 4.0.5 #change the scale_fill_manual from previous code to below p+ scale_fill_manual(values=rev(brewer.pal(7,&quot;YlGnBu&quot;)), na.value=&quot;grey90&quot;) ## Scale for &#39;fill&#39; is already present. Adding another scale for &#39;fill&#39;, which will replace ## the existing scale. "],["r语言韦恩图.html", "Chapter 9 R语言韦恩图", " Chapter 9 R语言韦恩图 韦恩图主要用来展示不同组数据之间的交集 R语言里画韦恩图的R包最常用的可能是VennDiagram,最多可以展示5组数据之间的交集，每组数据单独准备到一个文件里 library(readxl) dat01&lt;-read_excel(&quot;example_data/09-venndiagram/dat01.xlsx&quot;) dat02&lt;-read_excel(&quot;example_data/09-venndiagram/dat02.xlsx&quot;) dat03&lt;-read_excel(&quot;example_data/09-venndiagram/dat03.xlsx&quot;) dat04&lt;-read_excel(&quot;example_data/09-venndiagram/dat04.xlsx&quot;) library(VennDiagram) ## Loading required package: grid ## Loading required package: futile.logger ## ## Attaching package: &#39;VennDiagram&#39; ## The following object is masked from &#39;package:ggtree&#39;: ## ## rotate x&lt;-list(group1=dat01$gene_name, group2=dat02$gene_name, group3=dat03$gene_name, group4=dat04$gene_name) venn.diagram(x,filename = NULL) -&gt; p1 grid::grid.draw(p1) 有很多参数可以调节，这里介绍一下比较常用的 library(readxl) dat01&lt;-read_excel(&quot;example_data/09-venndiagram/dat01.xlsx&quot;) dat02&lt;-read_excel(&quot;example_data/09-venndiagram/dat02.xlsx&quot;) dat03&lt;-read_excel(&quot;example_data/09-venndiagram/dat03.xlsx&quot;) dat04&lt;-read_excel(&quot;example_data/09-venndiagram/dat04.xlsx&quot;) library(VennDiagram) x&lt;-list(group1=dat01$gene_name, group2=dat02$gene_name, group3=dat03$gene_name, group4=dat04$gene_name) venn.diagram(x, filename = NULL, main=&quot;ABC&quot;, sub=&quot;abc&quot;, fill=c(&quot;red&quot;,&quot;green&quot;,&quot;blue&quot;,&quot;yellow&quot;), col=&quot;grey&quot;, cat.cex=3) -&gt; p1 grid.draw(p1) ggplot2没有专门做venn图的函数，有人开发了ggplot2的扩展包用来画韦恩图 ggvenn https://github.com/yanlinlin82/ggvenn 最多能画4组数据 ggvenndiagram https://github.com/gaospecial/ggVennDiagram 最多能画7组数据 这里简单介绍一下ggvenn 安装直接运行install.packages(\"ggvenn\") 准备数据和VennDiagram的一眼 作图代码 library(readxl) dat01&lt;-read_excel(&quot;example_data/09-venndiagram/dat01.xlsx&quot;) dat02&lt;-read_excel(&quot;example_data/09-venndiagram/dat02.xlsx&quot;) dat03&lt;-read_excel(&quot;example_data/09-venndiagram/dat03.xlsx&quot;) dat04&lt;-read_excel(&quot;example_data/09-venndiagram/dat04.xlsx&quot;) x&lt;-list(group1=dat01$gene_name, group2=dat02$gene_name, group3=dat03$gene_name, group4=dat04$gene_name) library(ggvenn) ## Warning: package &#39;ggvenn&#39; was built under R version 4.0.5 ggvenn(x) ggvenn(x, fill_color = c(&quot;blue&quot;, &quot;yellow&quot;, &quot;green&quot;, &quot;red&quot;), fill_alpha = 0.5, stroke_color = &quot;grey&quot;, stroke_alpha = 1, stroke_size = 1, stroke_linetype = &quot;dashed&quot;, set_name_color = &quot;red&quot;, set_name_size = 6, text_color = &quot;black&quot;, text_size = 4, label_sep = &quot;,&quot;) VennDiagram 和 ggvenn 的每一个圈展示和每组数据集的多少并不是成比例的，比如第一组10个数据，第二组5个数据，第一组的圈应该比第二组的圈大 如果想要成比例的话，可以使用R包eulerr 这个整理数据集可能会复杂一些 可以画5个以上的韦恩图 dat&lt;-c(&quot;First&quot; = 25, &quot;Second&quot; = 5, &quot;Third&quot; = 5, &quot;First&amp;Second&quot; = 5, &quot;First&amp;Third&quot; = 5, &quot;Second&amp;Third&quot; = 3, &quot;First&amp;Second&amp;Third&quot; = 3) library(eulerr) ## Warning: package &#39;eulerr&#39; was built under R version 4.0.5 plot(euler(dat), fills = list(fill=c(&quot;red&quot;,&quot;blue&quot;, &quot;green&quot;,&quot;darkgreen&quot;, &quot;white&quot;,&quot;black&quot;, &quot;purple&quot;), alpha=0.5), quantities = list(c(25,5,5, 1,1,1,1), col=&quot;black&quot;, cex=4), labels = list(col=&quot;white&quot;,font=3,cex=2), edges = list(col=&quot;darkgreen&quot;,lwd=5, lty=1:3), main = list(label=c(&quot;XiaoMing&quot;),cex=5), legend = list(labels=c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;), cex=5)) 韦恩图如果数据超过5组，还有一种展示方式如下，可以借助UpSetR包实现 https://github.com/hms-dbmi/UpSetR 输入数据和之前介绍的一眼 library(readxl) dat01&lt;-read_excel(&quot;example_data/09-venndiagram/dat01.xlsx&quot;) dat02&lt;-read_excel(&quot;example_data/09-venndiagram/dat02.xlsx&quot;) dat03&lt;-read_excel(&quot;example_data/09-venndiagram/dat03.xlsx&quot;) dat04&lt;-read_excel(&quot;example_data/09-venndiagram/dat04.xlsx&quot;) x&lt;-list(group1=dat01$gene_name, group2=dat02$gene_name, group3=dat03$gene_name, group4=dat04$gene_name) library(UpSetR) ## Warning: package &#39;UpSetR&#39; was built under R version 4.0.5 upset(fromList(x), order.by = &quot;freq&quot;, point.size = 3.5, line.size = 2, mainbar.y.label = &quot;AAAA&quot;, sets.x.label = &quot;BBBB&quot;, text.scale = c(1.3, 1, 5, 0.75), main.bar.color=&quot;red&quot;) 来自一篇NC论文的实际例子 https://github.com/PlantNutrition/Liyu library(UpSetR)#R 3.5 otu_RA &lt;- read.delim(&#39;example_data/09-venndiagram/otu_RA.txt&#39;, header = TRUE, row.names = 1, sep = &#39;\\t&#39;) otu_RA[otu_RA &gt; 0] &lt;- 1 p &lt;- upset(otu_RA, nset = 7, nintersects = 10, order.by = c(&#39;degree&#39;,&#39;freq&#39;), decreasing = c(TRUE, TRUE), mb.ratio = c(0.7, 0.3), point.size = 1.8, line.size = 1, mainbar.y.label = &quot;Intersection size&quot;, sets.x.label = &quot;Set Size&quot;, main.bar.color = &quot;#2a83a2&quot;, sets.bar.color = &quot;#3b7960&quot;, queries = list(list(query = intersects, params = list(&quot;BS&quot;,&quot;RS&quot;,&quot;RE&quot;,&quot;VE&quot;,&quot;SE&quot;,&quot;LE&quot;,&quot;P&quot;), active = T, color=&quot;#d66a35&quot;, query.name = &quot;BS vs RS vs RE vs VE vs SE vs LE vs P&quot;))) p "],["r语言ggtree树状图.html", "Chapter 10 R语言ggtree树状图 10.1 进化树 10.2 ggtreeExtra添加额外注释信息", " Chapter 10 R语言ggtree树状图 树状图的应用场景可以简单分为两种：一种是聚类分析结果展示的树状图，一种是生物里经常用到的进化树的展示，这两种情况都可以用ggtree俩来展示结果，ggtree是专门用来可视化树状图的ggplot2的扩展包，功能非常强大，细节调整都可以用ggplot2的语法来做。环形的树状图还专门有一个R包ggtreeExtra,可以在树状图周围添加额外的数据 ggtree作者写了非常详细的帮助文档 https://yulab-smu.top/treedata-book/ ggtree的安装需要借助BiocManager BiocManager::install(\"ggtree\") 这个需要R的版本在4.0以上 聚类分析比较常用的是 层次聚类 K均值聚类 （暂时不知道如何用ggtree展示这个结果） 以下介绍层析聚类 示例数据集用鸢尾花iris的数据集，原始数据集有150个样本，3个品种，这里把样本减少，每个品种选5个样本 library(tidyverse) iris %&gt;% group_by(Species) %&gt;% sample_n(5) %&gt;% ungroup() %&gt;% mutate(sample.info=paste0(&quot;Sample&quot;,1:15)) %&gt;% write_csv(file = &quot;example_data/10-treediagram/iris_subset.csv&quot;) 层次聚类的函数是hclust(), 示例数据集截图 层次聚类的代码 library(tidyverse) dat01&lt;-read_csv(&quot;example_data/10-treediagram/iris_subset.csv&quot;) ## Rows: 15 Columns: 6 ## -- Column specification --------------------------------------------------------------------- ## Delimiter: &quot;,&quot; ## chr (2): Species, sample.info ## dbl (4): Sepal.Length, Sepal.Width, Petal.Length, Petal.Width ## ## i Use `spec()` to retrieve the full column specification for this data. ## i Specify the column types or set `show_col_types = FALSE` to quiet this message. head(dat01) ## # A tibble: 6 x 6 ## Sepal.Length Sepal.Width Petal.Length Petal.Width Species sample.info ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; ## 1 5.4 3.9 1.3 0.4 setosa Sample1 ## 2 5.2 3.5 1.5 0.2 setosa Sample2 ## 3 5.7 4.4 1.5 0.4 setosa Sample3 ## 4 5 3.6 1.4 0.2 setosa Sample4 ## 5 4.9 3.6 1.4 0.1 setosa Sample5 ## 6 5.6 3 4.5 1.5 versicolor Sample6 dat01 %&gt;% select(-Species) %&gt;% column_to_rownames(&quot;sample.info&quot;) -&gt; dat02 dat02 %&gt;% dist() %&gt;% hclust() -&gt; dat02.hclust library(ggtree) ggtree(dat02.hclust) ggtree(dat02.hclust)+ geom_tiplab() ggtree(dat02.hclust)+ geom_tiplab()+ geom_tippoint() ggtree(dat02.hclust)+ geom_tiplab()+ theme_tree2() ggtree(dat02.hclust)+ geom_tiplab()+ xlim(NA,4) ggtree(dat02.hclust)+ geom_tiplab()+ xlim(NA,4) -&gt; p p+ geom_text(aes(label=node)) p + geom_highlight(node = 17,fill=&quot;red&quot;) p + geom_highlight(node = 17,fill=&quot;red&quot;,extend=4) p + geom_strip(taxa1 = &quot;Sample5&quot;,taxa2 = &quot;Sample1&quot;,barsize = 5,label = &quot;ABCD&quot;,offset = 0.5,color = &quot;green&quot;,extend = 1,angle = 90,offset.text = 0.1) dat01 %&gt;% select(sample.info,Species) %&gt;% rename(&quot;label&quot;=&quot;sample.info&quot;)-&gt; dat03 ggtree(dat02.hclust) -&gt; p p %&lt;+% dat03 -&gt; p1 ggplot_build(p1) ## $data ## $data[[1]] ## y x node parent PANEL group xend yend colour size linetype alpha ## 1 1.00000 2.869042 1 23 1 -1 3.177263 1.00000 black 0.5 1 NA ## 2 3.00000 3.004058 2 22 1 -1 3.177263 3.00000 black 0.5 1 NA ## 3 2.00000 2.869042 3 23 1 -1 3.177263 2.00000 black 0.5 1 NA ## 4 4.00000 3.106552 4 29 1 -1 3.177263 4.00000 black 0.5 1 NA ## 5 5.00000 3.106552 5 29 1 -1 3.177263 5.00000 black 0.5 1 NA ## 6 9.00000 3.027263 6 28 1 -1 3.177263 9.00000 black 0.5 1 NA ## 7 7.00000 2.942742 7 25 1 -1 3.177263 7.00000 black 0.5 1 NA ## 8 10.00000 3.027263 8 28 1 -1 3.177263 10.00000 black 0.5 1 NA ## 9 6.00000 2.721741 9 19 1 -1 3.177263 6.00000 black 0.5 1 NA ## 10 8.00000 2.948134 10 27 1 -1 3.177263 8.00000 black 0.5 1 NA ## 11 14.00000 3.011432 11 26 1 -1 3.177263 14.00000 black 0.5 1 NA ## 12 13.00000 2.853226 12 24 1 -1 3.177263 13.00000 black 0.5 1 NA ## 13 11.00000 2.159913 13 20 1 -1 3.177263 11.00000 black 0.5 1 NA ## 14 15.00000 3.011432 14 26 1 -1 3.177263 15.00000 black 0.5 1 NA ## 15 12.00000 2.702921 15 21 1 -1 3.177263 12.00000 black 0.5 1 NA ## 16 6.03125 0.000000 16 16 1 -1 0.000000 6.03125 black 0.5 1 NA ## 17 2.62500 0.000000 17 16 1 -1 2.589896 2.62500 black 0.5 1 NA ## 18 9.43750 0.000000 18 16 1 -1 1.396814 9.43750 black 0.5 1 NA ## 19 6.93750 1.396814 19 18 1 -1 2.721741 6.93750 black 0.5 1 NA ## 20 11.93750 1.396814 20 18 1 -1 2.159913 11.93750 black 0.5 1 NA ## 21 12.87500 2.159913 21 20 1 -1 2.702921 12.87500 black 0.5 1 NA ## 22 3.75000 2.589896 22 17 1 -1 3.004058 3.75000 black 0.5 1 NA ## 23 1.50000 2.589896 23 17 1 -1 2.869042 1.50000 black 0.5 1 NA ## 24 13.75000 2.702921 24 21 1 -1 2.853226 13.75000 black 0.5 1 NA ## 25 7.87500 2.721741 25 19 1 -1 2.942742 7.87500 black 0.5 1 NA ## 26 14.50000 2.853226 26 24 1 -1 3.011432 14.50000 black 0.5 1 NA ## 27 8.75000 2.942742 27 25 1 -1 2.948134 8.75000 black 0.5 1 NA ## 28 9.50000 2.948134 28 27 1 -1 3.027263 9.50000 black 0.5 1 NA ## 29 4.50000 3.004058 29 22 1 -1 3.106552 4.50000 black 0.5 1 NA ## ## $data[[2]] ## y x node parent PANEL group xend yend colour size linetype alpha ## 1 1.50000 2.869042 1 23 1 -1 2.869042 1.00000 black 0.5 1 NA ## 2 3.75000 3.004058 2 22 1 -1 3.004058 3.00000 black 0.5 1 NA ## 3 1.50000 2.869042 3 23 1 -1 2.869042 2.00000 black 0.5 1 NA ## 4 4.50000 3.106552 4 29 1 -1 3.106552 4.00000 black 0.5 1 NA ## 5 4.50000 3.106552 5 29 1 -1 3.106552 5.00000 black 0.5 1 NA ## 6 9.50000 3.027263 6 28 1 -1 3.027263 9.00000 black 0.5 1 NA ## 7 7.87500 2.942742 7 25 1 -1 2.942742 7.00000 black 0.5 1 NA ## 8 9.50000 3.027263 8 28 1 -1 3.027263 10.00000 black 0.5 1 NA ## 9 6.93750 2.721741 9 19 1 -1 2.721741 6.00000 black 0.5 1 NA ## 10 8.75000 2.948134 10 27 1 -1 2.948134 8.00000 black 0.5 1 NA ## 11 14.50000 3.011432 11 26 1 -1 3.011432 14.00000 black 0.5 1 NA ## 12 13.75000 2.853226 12 24 1 -1 2.853226 13.00000 black 0.5 1 NA ## 13 11.93750 2.159913 13 20 1 -1 2.159913 11.00000 black 0.5 1 NA ## 14 14.50000 3.011432 14 26 1 -1 3.011432 15.00000 black 0.5 1 NA ## 15 12.87500 2.702921 15 21 1 -1 2.702921 12.00000 black 0.5 1 NA ## 16 6.03125 0.000000 16 16 1 -1 0.000000 6.03125 black 0.5 1 NA ## 17 6.03125 0.000000 17 16 1 -1 0.000000 2.62500 black 0.5 1 NA ## 18 6.03125 0.000000 18 16 1 -1 0.000000 9.43750 black 0.5 1 NA ## 19 9.43750 1.396814 19 18 1 -1 1.396814 6.93750 black 0.5 1 NA ## 20 9.43750 1.396814 20 18 1 -1 1.396814 11.93750 black 0.5 1 NA ## 21 11.93750 2.159913 21 20 1 -1 2.159913 12.87500 black 0.5 1 NA ## 22 2.62500 2.589896 22 17 1 -1 2.589896 3.75000 black 0.5 1 NA ## 23 2.62500 2.589896 23 17 1 -1 2.589896 1.50000 black 0.5 1 NA ## 24 12.87500 2.702921 24 21 1 -1 2.702921 13.75000 black 0.5 1 NA ## 25 6.93750 2.721741 25 19 1 -1 2.721741 7.87500 black 0.5 1 NA ## 26 13.75000 2.853226 26 24 1 -1 2.853226 14.50000 black 0.5 1 NA ## 27 7.87500 2.942742 27 25 1 -1 2.942742 8.75000 black 0.5 1 NA ## 28 8.75000 2.948134 28 27 1 -1 2.948134 9.50000 black 0.5 1 NA ## 29 3.75000 3.004058 29 22 1 -1 3.004058 4.50000 black 0.5 1 NA ## ## ## $layout ## &lt;ggproto object: Class Layout, gg&gt; ## coord: &lt;ggproto object: Class CoordCartesian, Coord, gg&gt; ## aspect: function ## backtransform_range: function ## clip: on ## default: TRUE ## distance: function ## expand: TRUE ## is_free: function ## is_linear: function ## labels: function ## limits: list ## modify_scales: function ## range: function ## render_axis_h: function ## render_axis_v: function ## render_bg: function ## render_fg: function ## setup_data: function ## setup_layout: function ## setup_panel_guides: function ## setup_panel_params: function ## setup_params: function ## train_panel_guides: function ## transform: function ## super: &lt;ggproto object: Class CoordCartesian, Coord, gg&gt; ## coord_params: list ## facet: &lt;ggproto object: Class FacetNull, Facet, gg&gt; ## compute_layout: function ## draw_back: function ## draw_front: function ## draw_labels: function ## draw_panels: function ## finish_data: function ## init_scales: function ## map_data: function ## params: list ## setup_data: function ## setup_params: function ## shrink: TRUE ## train_scales: function ## vars: function ## super: &lt;ggproto object: Class FacetNull, Facet, gg&gt; ## facet_params: list ## finish_data: function ## get_scales: function ## layout: data.frame ## map_position: function ## panel_params: list ## panel_scales_x: list ## panel_scales_y: list ## render: function ## render_labels: function ## reset_scales: function ## setup: function ## setup_panel_guides: function ## setup_panel_params: function ## train_position: function ## xlabel: function ## ylabel: function ## super: &lt;ggproto object: Class Layout, gg&gt; ## ## $plot ## ## attr(,&quot;class&quot;) ## [1] &quot;ggplot_built&quot; p1+ geom_tiplab(aes(color=Species)) p1 + geom_tippoint(aes(shape=Species,color=Species),size=5) ggtree(dat02.hclust,layout = &quot;circular&quot;) -&gt; p.circular p.circular %&lt;+% dat03 -&gt; p1.circular p1.circular p1.circular + geom_tippoint(aes(color=Species,shape=Species),size=10) 10.1 进化树 进化树最常用到的格式是newick,格式如下 library(treeio) tree&lt;-read.newick(&quot;example_data/10-treediagram/example_tree.nwk&quot;, node.label = &quot;support&quot;) ggtree(tree) ggtree(tree,layout = &quot;circular&quot;) ggtree(tree)+ geom_tiplab()+ geom_nodelab(aes(label=support)) ggtree(tree)+ geom_tiplab()+ geom_nodepoint(aes(size=support)) ## Warning: Removed 1 rows containing missing values (geom_point_g_gtree). ggtree(tree)+ geom_tiplab()+ geom_nodepoint(aes(size=support))+ scale_size_continuous(range = c(5,10)) ## Warning: Removed 1 rows containing missing values (geom_point_g_gtree). #ggtree(tree,layout = &quot;daylight&quot;) 10.2 ggtreeExtra添加额外注释信息 library(tidyverse) library(readxl) dat01&lt;-read_excel(&quot;example_data/10-treediagram/tree_extra_info.xlsx&quot;) tree&lt;-read.newick(&quot;example_data/10-treediagram/example_tree.nwk&quot;, node.label = &quot;support&quot;) ggtree(tree) -&gt; p1 #p %&lt;+% dat01 -&gt; p1 p1 library(ggtreeExtra) p1+ geom_tiplab()+ geom_fruit(data = dat01, geom = geom_point, mapping = aes(y=ID,size=barplot) )+ geom_fruit(data = dat01, geom = geom_bar, mapping = aes(y=ID,x=barplot), stat=&quot;identity&quot;, orientation = &quot;y&quot;, axis.params = list(axis=&quot;x&quot;), grid.params = list()) dat02&lt;-read_excel(&quot;example_data/10-treediagram/tree_extra_info.xlsx&quot;, sheet = &quot;Sheet2&quot;) p1+ geom_tiplab()+ geom_fruit(data = dat01, geom = geom_point, mapping = aes(y=ID,size=barplot) )+ geom_fruit(data = dat01, geom = geom_bar, mapping = aes(y=ID,x=barplot), stat=&quot;identity&quot;, orientation = &quot;y&quot;, axis.params = list(axis=&quot;x&quot;), grid.params = list())+ geom_fruit(data=dat02, geom = geom_tile, mapping = aes(y=ID,x=x,fill=value), pwidth = 0.1) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
